---
title: æ—¥å¿—ç®¡ç†ï¼ˆå…„å¼Ÿè¿žï¼‰
date: 2022-08-15 14:34:43
tags:
categories:
- [å­¦ä¹ , DevOPS, å…„å¼Ÿè¿žLinuxå­¦ä¹ ]
valine:
  placeholder: "1. æé—®å‰è¯·å…ˆä»”ç»†é˜…è¯»æœ¬æ–‡æ¡£âš¡\n2. é¡µé¢æ˜¾ç¤ºé—®é¢˜ðŸ’¥ï¼Œè¯·æä¾›æŽ§åˆ¶å°æˆªå›¾ðŸ“¸æˆ–è€…æ‚¨çš„æµ‹è¯•ç½‘å€\n3. å…¶ä»–ä»»ä½•æŠ¥é”™ðŸ’£ï¼Œè¯·æä¾›è¯¦ç»†æè¿°å’Œæˆªå›¾ðŸ“¸ï¼Œç¥é£Ÿç”¨æ„‰å¿«ðŸ’ª"
---

# ç®€ä»‹

## æ—¥å¿—æœåŠ¡
åœ¨centos6.xä¸­æ—¥å¿—æœåŠ¡å·²ç»ç”±rsyslogdå–ä»£äº†åŽŸå…ˆçš„syslogdæœåŠ¡ã€‚rsyslogdæ—¥å¿—æœåŠ¡æ›´åŠ å…ˆè¿›ï¼ŒåŠŸèƒ½æ›´å¤šã€‚ä½†æ˜¯ä¸è®ºè¯¥æœåŠ¡çš„ä½¿ç”¨ï¼Œè¿˜æ˜¯æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼å…¶å®žéƒ½æ˜¯å’ŒsyslogdæœåŠ¡ç›¸å…¼å®¹çš„ï¼Œæ‰€ä»¥å­¦ä¹ èµ·æ¥åŸºæœ¬å’ŒsyslogdæœåŠ¡ä¸€è‡´ã€‚

rsyslogdçš„æ–°ç‰¹ç‚¹ï¼š
- åŸºäºŽTCPç½‘ç»œåè®®ä¼ è¾“æ—¥å¿—ä¿¡æ¯ï¼›
- æ›´å®‰å…¨çš„ç½‘ç»œä¼ è¾“æ–¹å¼ï¼›
- æœ‰æ—¥å¿—æ¶ˆæ¯çš„åŠæ—¶åˆ†æžæ¡†æž¶ï¼›
- åŽå°æ•°æ®åº“ï¼›
- é…ç½®æ–‡ä»¶ä¸­å¯ä»¥å†™ç®€å•çš„é€»è¾‘åˆ¤æ–­ï¼›
- ä¸Žsyslogé…ç½®æ–‡ä»¶ç›¸å…¼å®¹ï¼›

ç¡®å®šæœåŠ¡å¯åŠ¨

```bash
[root@core-pods-3 ~]# ps aux | grep rsyslogd
root     14900  0.0  0.9 253384  9292 ?        Ssl  Jul26   1:43 /usr/sbin/rsyslogd -n
root     17795  0.0  0.2 112824  2280 pts/1    S+   09:04   0:00 grep --color=auto rsyslogd
[root@core-pods-3 ~]# systemctl list-unit-files | grep rsysl   # æŸ¥çœ‹æ˜¯å¦è‡ªå¯åŠ¨ï¼Œcentos7ï¼Œ6æ˜¯chkconfig --list
rsyslog.service                               enabled 
```

## å¸¸è§æ—¥å¿—çš„ä½œç”¨

|æ—¥å¿—æ–‡ä»¶|è¯´æ˜Ž|
|---|---|
|/var/log/cron|è®°å½•äº†ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—|
|/var/log/cups/|è®°å½•æ‰“å°ä¿¡æ¯çš„æ—¥å¿—|
|/var/log/dmesg|è®°å½•äº†ç³»ç»Ÿåœ¨å¼€æœºæ—¶å†…æ ¸è‡ªæ£€çš„ä¿¡æ¯ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨dmesgå‘½ä»¤ç›´æŽ¥æŸ¥çœ‹å†…æ ¸è‡ªæ£€ä¿¡æ¯|
|/var/log/btmp|è®°å½•é”™è¯¯ç™»å½•çš„æ—¥å¿—ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½viç›´æŽ¥æŸ¥çœ‹ï¼Œè€Œè¦ä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹ï¼Œå‘½ä»¤å¦‚ä¸‹`lastb`ï¼Œå¦‚æžœæœ‰äººåœ¨æš´åŠ›ç ´è§£ç™»å½•ï¼Œå¯ä»¥æŸ¥åˆ°è®°å½•|
|/var/log/lastlog|è®°å½•ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€åŽä¸€æ¬¡çš„ç™»å½•æ—¶é—´çš„æ—¥å¿—ã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æŽ¥viï¼Œè¦ä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹|
|/var/log/mailog|è®°å½•é‚®ä»¶ä¿¡æ¯|
|/var/log/message|è®°å½•ç³»ç»Ÿé‡è¦ä¿¡æ¯çš„æ—¥å¿—ã€‚è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ä¼šè®°å½•linuxç³»ç»Ÿçš„ç»å¤§å¤šæ•°é‡è¦ä¿¡æ¯ï¼Œå¦‚æžœç³»ç»Ÿå‡ºçŽ°é—®é¢˜ï¼Œé¦–å…ˆè¦æ£€æŸ¥çš„å°±åº”è¯¥æ˜¯è¿™ä¸ªæ—¥å¿—æ–‡ä»¶|
|/var/log/secure|è®°å½•éªŒè¯å’ŒæŽˆæƒæ–¹é¢çš„ä¿¡æ¯ï¼Œåªè¦æ¶‰åŠè´¦æˆ·å’Œå¯†ç çš„ç¨‹åºéƒ½ä¼šè®°å½•ã€‚æ¯”å¦‚è¯´ç³»ç»Ÿçš„ç™»å½•ï¼Œsshçš„ç™»å½•ï¼Œsuåˆ‡æ¢ç”¨æˆ·ï¼ŒsudoæŽˆæƒï¼Œç”šè‡³æ·»åŠ ç”¨æˆ·å’Œä¿®æ”¹ç”¨æˆ·å¯†ç éƒ½ä¼šè®°å½•åœ¨è¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚|
|/var/log/wtmp|æ°¸ä¹…è®°å½•æ‰€æœ‰ç”¨æˆ·çš„ç™»å½•ã€æ³¨é”€ä¿¡æ¯ï¼ŒåŒæ—¶è®°å½•ç³»ç»Ÿçš„å¯åŠ¨ã€é‡å¯ã€å…³æœºäº‹ä»¶ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸èƒ½ç›´æŽ¥viï¼Œè€Œéœ€è¦ä½¿ç”¨lastå‘½ä»¤æ¥æŸ¥çœ‹|
|/var/run/utmp|è®°å½•å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™ä¸ªæ–‡ä»¶ä¼šéšç€ç”¨æˆ·çš„ç™»å½•å’Œæ³¨é”€è€Œä¸æ–­å˜åŒ–ï¼Œåªè®°å½•å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚åŒæ ·è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ç›´æŽ¥viï¼Œè€Œè¦ä½¿ç”¨wï¼Œwhoï¼Œusersç­‰å‘½ä»¤æ¥æŸ¥è¯¢ã€‚|

é™¤äº†ç³»ç»Ÿé»˜è®¤çš„æ—¥å¿—ä¹‹å¤–ï¼Œé‡‡ç”¨rpmæ–¹å¼å®‰è£…çš„ç³»ç»ŸæœåŠ¡ä¹Ÿä¼šé»˜è®¤æŠŠæ—¥å¿—è®°å½•åœ¨/var/log/ç›®å½•ä¸­ï¼ˆæºç åŒ…å®‰è£…çš„æœåŠ¡æ—¥å¿—æ˜¯åœ¨æºç åŒ…æŒ‡å®šç›®å½•ä¸­ï¼‰ã€‚ä¸è¿‡è¿™äº›æ—¥å¿—ä¸æ˜¯æœ‰rsyslogdæœåŠ¡æ¥è®°å½•å’Œç®¡ç†çš„ï¼Œè€Œæ˜¯å„ä¸ªæœåŠ¡ä½¿ç”¨è‡ªå·±çš„æ—¥å¿—ç®¡ç†æ–‡æ¡£æ¥è®°å½•è‡ªèº«æ—¥å¿—ã€‚æ¯”å¦‚ï¼š

|æ—¥å¿—æ–‡ä»¶|è¯´æ˜Ž|
|---|---|
|/var/log/httpd/|RPMåŒ…å®‰è£…çš„apacheæœåŠ¡çš„é»˜è®¤æ—¥å¿—ç›®å½•|
|/var/log/mail/|RPMåŒ…å®‰è£…çš„é‚®ä»¶æœåŠ¡çš„é¢å¤–æ—¥å¿—ç›®å½•|
|/var/log/samba/|RPMåŒ…å®‰è£…çš„sambaæœåŠ¡çš„æ—¥å¿—ç›®å½•|
|/var/log/sssd/|å®ˆæŠ¤è¿›ç¨‹å®‰å…¨æœåŠ¡ç›®å½•|

# rsyslogdæœåŠ¡

## æ—¥å¿—æ–‡ä»¶æ ¼å¼

åŸºæœ¬æ—¥å¿—æ ¼å¼åŒ…å«ä»¥ä¸‹å››åˆ—ï¼š
- äº‹ä»¶å‘ç”Ÿçš„äº‹ä»¶ï¼›
- å‘ç”Ÿäº‹ä»¶çš„æœåŠ¡å™¨çš„ä¸»æœºåï¼›
- äº§ç”Ÿäº‹ä»¶çš„æœåŠ¡åæˆ–ç¨‹åºåï¼›
- äº‹ä»¶çš„å…·ä½“ä¿¡æ¯ï¼›

## /etc/rsyslog.confé…ç½®æ–‡ä»¶

```bash
authpriv.*                           /var/log/secure
# æ ¼å¼ï¼šæœåŠ¡åç§°[è¿žæŽ¥ç¬¦å·]æ—¥å¿—ç­‰çº§     æ—¥å¿—è®°å½•ä½ç½®
# ä¾‹å­ï¼šè®¤è¯ç›¸å…³æœåŠ¡.æ‰€æœ‰æ—¥å¿—ç­‰çº§      è®°å½•åœ¨/var/log/secureæ—¥å¿—ä¸­
```

ä¸‹é¢è§£é‡Šä¸Šé¢æ ¼å¼é‡Œçš„å„ä¸ªéƒ¨åˆ†ï¼š

1. æœåŠ¡åç§°

|æœåŠ¡åç§°|è¯´æ˜Ž|
| --- | --- |
|auth|å®‰å…¨å’Œè®¤è¯ç›¸å…³æ¶ˆæ¯ï¼ˆä¸æŽ¨èä½¿ç”¨authprivæ›¿ä»£ï¼‰|
|authpriv|å®‰å…¨å’Œè®¤è¯ç›¸å…³æ¶ˆæ¯ï¼ˆç§æœ‰çš„ï¼‰|
|cron|ç³»ç»Ÿå®šæ—¶ä»»åŠ¡crontå’Œatäº§ç”Ÿçš„æ—¥å¿—|
|daemon|å’Œå„ä¸ªå®ˆæŠ¤è¿›ç¨‹ç›¸å…³çš„æ—¥å¿—|
|ftp|ftpå®ˆæŠ¤è¿›ç¨‹äº§ç”Ÿçš„æ—¥å¿—|
|kern|å†…æ ¸äº§ç”Ÿçš„æ—¥å¿—ï¼ˆä¸æ˜¯ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿçš„ï¼‰|
|local0 - local7|ä¸ºæœ¬åœ°ä½¿ç”¨é¢„ç•™çš„æœåŠ¡|
|lpr|æ‰“å°äº§ç”Ÿçš„æ—¥å¿—|
|mail|é‚®ä»¶æ”¶å‘ä¿¡æ¯|
|news|ä¸Žæ–°é—»æœåŠ¡å™¨ç›¸å…³çš„æ—¥å¿—|
|syslog|æœ‰syslogdæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼ˆè™½ç„¶æœåŠ¡åç§°å·²ç»æ”¹ä¸ºrsyslogdï¼Œä½†æ˜¯å¾ˆå¤šé…ç½®éƒ½è¿˜æ˜¯æ²¿ç”¨äº†syslogdçš„ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä¿®æ”¹æœåŠ¡åï¼‰|
|user|ç”¨æˆ·ç­‰çº§ç±»åˆ«çš„æ—¥å¿—ä¿¡æ¯|
|uucp|uucpå­ç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯ï¼Œuucpæ˜¯æ—©æœŸlinuxç³»ç»Ÿè¿›è¡Œæ•°æ®ä¼ é€’çš„åè®®ï¼ŒåŽæ¥ä¹Ÿå¸¸ç”¨åœ¨æ–°é—»ç»„æœåŠ¡ä¸­|

2. è¿žæŽ¥ç¬¦å·

   è¿žæŽ¥ç¬¦å·å¯ä»¥è¯†åˆ«ä¸ºï¼š

   - `â€œ.â€`ä»£è¡¨åªè¦æ¯”åŽé¢çš„ç­‰çº§é«˜çš„ï¼ˆåŒ…å«è¯¥ç­‰çº§ï¼‰æ—¥å¿—éƒ½è®°å½•ä¸‹æ¥ã€‚æ¯”å¦‚ï¼šâ€œcron.infoâ€ä»£è¡¨cronæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—ï¼Œåªè¦ä¹‹æ—¥ç­‰çº§å¤§äºŽç­‰äºŽinfoçº§åˆ«ï¼Œå°±è®°å½•
   - `â€œ.=â€`ä»£è¡¨åªè®°å½•æ‰€éœ€ç­‰çº§çš„æ—¥å¿—ï¼Œå…¶ä»–ç­‰çº§çš„æ—¥å¿—éƒ½ä¸è®°å½•ã€‚æ¯”å¦‚ï¼šâ€œ*.=emergâ€ä»£è¡¨äººå’Œæ—¥å¿—æœåŠ¡äº§ç”Ÿçš„æ—¥å¿—ï¼Œåªè¦ç­‰çº§æ˜¯emergç­‰çº§å°±è®°å½•ã€‚è¿™ç§ç”¨æ³•æžå°‘è§ï¼Œäº†è§£å°±å¥½
   - `â€œ.!â€`ä»£è¡¨ä¸ç­‰äºŽï¼Œä¹Ÿå°±æ˜¯é™¤äº†è¯¥ç­‰çº§çš„æ—¥å¿—å¤–ï¼Œå…¶ä»–ç­‰çº§çš„æ—¥å¿—éƒ½è®°å½•

   > `â€œ*â€`ä»£è¡¨æ‰€æœ‰æ—¥å¿—ç­‰çº§ï¼Œæ¯”å¦‚ï¼šâ€œauthpriv.*â€ä»£è¡¨authprivè®¤è¯ä¿¡æ¯æœåŠ¡äº§ç”Ÿçš„æ—¥å¿—ï¼Œæ‰€æœ‰çš„æ—¥å¿—ç­‰çº§éƒ½è®°å½•

æ—¥å¿—ç­‰çº§

|ç­‰çº§åç§°|è¯´æ˜Ž|
|---|---|
|debug|ä¸€èˆ¬çš„è°ƒè¯•ä¿¡æ¯è¯´æ˜Ž|
|info|åŸºæœ¬çš„é€šçŸ¥ä¿¡æ¯|
|notice|æ™®é€šä¿¡æ¯ï¼Œä½†æ˜¯æœ‰ä¸€å®šçš„é‡è¦æ€§|
|warning|è­¦å‘Šä¿¡æ¯ï¼Œä½†æ˜¯è¿˜ä¸ä¼šå½±å“åˆ°æœåŠ¡æˆ–ç³»ç»Ÿçš„è¿è¡Œ|
|err|é”™è¯¯ä¿¡æ¯ï¼Œä¸€èˆ¬è¾¾åˆ°errç­‰çº§çš„ä¿¡æ¯ä»¥åŠå¯ä»¥å½±å“åˆ°æœåŠ¡æˆ–ç³»ç»Ÿçš„è¿è¡Œäº†|
|crit|ä¸´ç•ŒçŠ¶å†µä¿¡æ¯ï¼Œæ¯”errè¿˜è¦ä¸¥é‡ï¼ˆcriticalï¼‰|
|alert|è­¦å‘ŠçŠ¶æ€ä¿¡æ¯ï¼Œæ¯”critè¿˜è¦ä¸¥é‡ã€‚å¿…é¡»ç«‹å³é‡‡å–è¡ŒåŠ¨|
|emerg|ç–¼ç—›ç­‰çº§ä¿¡æ¯ï¼Œç³»ç»Ÿå·²ç»æ— æ³•ä½¿ç”¨äº†ï¼ˆemergencyï¼‰|

æ—¥å¿—è®°å½•ä½ç½®

- æ—¥å¿—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œå¦‚â€œ/var/log/secureâ€
- ç³»ç»Ÿè®¾å¤‡æ–‡ä»¶ï¼Œå¦‚â€œ/dev/lp0â€
- è½¬å‘ç»™è¿œç¨‹ä¸»æœºï¼Œå¦‚â€œ@192.168.0.210:513â€
- ç”¨æˆ·åï¼Œå¦‚â€œrootâ€
- å¿½ç•¥æˆ–ä¸¢å¼ƒæ—¥å¿—ï¼Œå¦‚â€œ~â€

# æ—¥å¿—è½®æ›¿

## è¯´æ˜Ž

- æ—¥å¿—åˆ‡å‰²ï¼šæŠŠå¤§æ—¥å¿—æŒ‰ç…§å›ºå®šè§„åˆ™æ‹†åˆ†æˆå°æ—¥å¿—ï¼Œæ¯”å¦‚æŒ‰å¤©è®°å½•ã€‚apacheè‡ªå¸¦åˆ‡å‰²åŠŸèƒ½ï¼Œä½†æ˜¯ä¸æ”¯æŒè½®æ›¿
- æ—¥å¿—è½®æ›¿ï¼šæŠŠæ—§çš„æ—¥å¿—åˆ é™¤ï¼Œæ¯”å¦‚åªè®°å½•æœ€è¿‘30å¤©çš„æ—¥å¿—ï¼Œ

## æ—¥å¿—æ–‡ä»¶çš„å‘½ä»¤è§„åˆ™
å¦‚æžœé…ç½®æ–‡ä»¶ä¸­æ‹¥æœ‰â€œdateextâ€å‚æ•°ï¼Œé‚£ä¹ˆæ—¥å¿—ä¼šç”¨æ—¥æœŸæ¥ä½œä¸ºæ—¥å¿—æ–‡ä»¶çš„åŽç¼€ï¼Œä¾‹å¦‚â€œsecure-20130605â€ã€‚è¿™æ ·çš„è¯æ—¥å¿—æ–‡ä»¶åä¸ä¼šé‡å ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦æ—¥å¿—æ–‡ä»¶çš„æ”¹åï¼Œåªéœ€è¦ä¿å­˜æŒ‡å®šçš„æ—¥å¿—ä¸ªæ•°ï¼Œåˆ é™¤å¤šä½™çš„æ—¥å¿—æ–‡ä»¶å³å¯ã€‚

å¦‚æžœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰â€œdateextâ€å‚æ•°ï¼Œé‚£ä¹ˆæ—¥å¿—æ–‡ä»¶å°±éœ€è¦è¿›è¡Œæ”¹åäº†ã€‚å½“ç¬¬ä¸€æ¬¡è¿›è¡Œæ—¥å¿—è½®æ›¿æ—¶ï¼Œå½“å‰çš„â€œsecureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.1â€ï¼Œç„¶åŽæ–°å»ºâ€œsecureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„ä¹‹æ—¥ã€‚å½“ç¬¬äºŒæ¬¡è¿›è¡Œæ—¥å¿—è½®æ›¿æ—¶ï¼Œâ€œsecure.1â€ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.2â€ï¼Œå½“å‰çš„â€œsecureâ€æ—¥å¿—ä¼šè‡ªåŠ¨æ”¹åä¸ºâ€œsecure.1â€ï¼Œç„¶åŽä¹Ÿä¼šæ–°å»ºâ€œsecureâ€æ—¥å¿—ï¼Œç”¨æ¥ä¿å­˜æ–°çš„æ—¥å¿—ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚

çŽ°åœ¨ä¸€èˆ¬é…ç½®æ–‡ä»¶é‡Œéƒ½åŠ äº†â€œdateextâ€å‚æ•°ã€‚

## logrotateé…ç½®æ–‡ä»¶

|å‚æ•°|å‚æ•°è¯´æ˜Ž|
|---|---|
|daily|æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å¤©|
|weekly|æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯å‘¨|
|monthly|æ—¥å¿—çš„è½®æ›¿å‘¨æœŸæ˜¯æ¯æœˆ|
|rotate æ•°å­—|ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶çš„ä¸ªæ•°ã€‚0æŒ‡æ²¡æœ‰å¤‡ä»½|
|compress|æ—¥å¿—è½®æ›¿æ—¶ï¼Œæ—§çš„æ—¥å¿—è¿›è¡ŒåŽ‹ç¼©|
|create mode owner group|å»ºç«‹æ–°æ—¥å¿—ï¼ŒåŒæ—¶æŒ‡å®šæ–°æ—¥å¿—çš„æƒé™ä¸Žæ‰€æœ‰è€…å’Œæ‰€å±žç»„ã€‚å¦‚create 0600 root utmp|
|mail address|å½“æ—¥å¿—è½®æ›¿æ—¶ï¼Œè¾“å‡ºå†…å®¹é€šè¿‡é‚®ä»¶å‘é€åˆ°æŒ‡å®šçš„é‚®ä»¶åœ°å€ã€‚å¦‚mail jasu@cis.com|
|missingok|å¦‚æžœæ—¥å¿—ä¸å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ—¥å¿—çš„è­¦å‘Šä¿¡æ¯|
|notifempty|å¦‚æžœæ—¥å¿—ä¸ºç©ºæ–‡ä»¶ï¼Œåˆ™ä¸è¿›è¡Œæ—¥å¿—è½®æ›¿|
|minsize å¤§å°|æ—¥å¿—è½®æ›¿çš„æœ€å°å€¼ã€‚ä¹Ÿå°±æ˜¯æ—¥å¿—ä¸€å®šè¦è¾¾åˆ°è¿™ä¸ªæœ€å°å€¼æ‰ä¼šè½®æ›¿ï¼Œå¦åˆ™å°±ç®—äº‹ä»¶è¾¾åˆ°ä¹Ÿä¸è½®æ›¿|
|size å¤§å°|æ—¥å¿—åªæœ‰å¤§äºŽæŒ‡å®šå¤§å°æ‰è¿›è¡Œæ—¥å¿—è½®æ›¿ï¼Œè€Œä¸æ˜¯æŒ‰ç…§äº‹ä»¶è½®æ›¿ã€‚å¦‚size 100k|
|dateext|ä½¿ç”¨æ—¥æœŸä½œä¸ºæ—¥å¿—è½®æ›¿æ–‡ä»¶çš„åŽç¼€ã€‚å¦‚secure-20130605|

## æŠŠapacheæ—¥å¿—åŠ å…¥è½®æ›¿

åªæœ‰æºç åŒ…å®‰è£…çš„æœåŠ¡éœ€è¦æ‰‹åŠ¨åšè½®æ›¿ï¼ŒrpmåŒ…å®‰è£…çš„é€šå¸¸å·²ç»é»˜è®¤é…ç½®å¥½è½®æ›¿ã€‚

```
[root@core-pods-3 ~]# vi /etc/logrotate.conf

/usr/local/apache2/logs/access_log {
  daily
  create
  rotate 30
}

[root@core-pods-3 ~]# ll /etc/logrotate.d
total 40
-rw-r--r-- 1 root root  91 Sep 30  2020 bootlog
-rw-r--r-- 1 root root 160 Sep 19  2018 chrony
-rw-r--r-- 1 root root  93 Apr 28  2021 firewalld
-rw-r--r-- 1 root root 194 Jan  7  2022 httpd
-rw-r--r-- 1 root root 810 Oct  1  2020 mariadb
-rw-r--r-- 1 root root 261 Oct 18  2021 nginx
-rw-r--r-- 1 root root 136 Feb 27  2020 ppp
-rw-r--r-- 1 root root 224 Jan 13  2022 syslog
-rw-r--r-- 1 root root 100 Mar 16  2021 wpa_supplicant
-rw-r--r-- 1 root root 103 Oct  1  2020 yum
```
## logrotateå‘½ä»¤

å‘½ä»¤æ˜¯`logrotate [é€‰é¡¹] é…ç½®æ–‡ä»¶å`ï¼Œå¦‚æžœæ­¤å‘½ä»¤æ²¡æœ‰é€‰é¡¹ï¼Œåˆ™ä¼šæŒ‰ç…§é…ç½®æ–‡ä»¶ä¸­çš„æ¡ä»¶è¿›è¡Œæ—¥å¿—è½®æ›¿ï¼Œé€‰é¡¹æœ‰ï¼š
- -vï¼šæ˜¾ç¤ºæ—¥å¿—è½®æ›¿è¿‡ç¨‹ã€‚åŠ äº†-vé€‰é¡¹ï¼Œä¼šæ˜¾ç¤ºæ—¥å¿—çš„è½®æ›¿çš„è¿‡ç¨‹
- -fï¼šå¼ºåˆ¶è¿›è¡Œæ—¥å¿—è½®æ›¿ã€‚ä¸ç®¡æ—¥å¿—è½®æ›¿çš„æ¡ä»¶æ˜¯å¦å·²ç»ç¬¦åˆï¼Œå¼ºåˆ¶é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ—¥å¿—è¿›è¡Œè½®æ›¿

```bash
[root@core-pods-3 ~]# logrotate -v /etc/logrotate.conf 
[root@core-pods-3 ~]# logrotate -f /etc/logrotate.conf   # æ­¤æ—¶ä¼šçœ‹åˆ°æ—¥å¿—rotateç»“æžœ
```

# é™„å½•

## å®šæœŸåˆ é™¤æ—¥å¿—æ–¹æ¡ˆ

è®¾ç½®linux crontabå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æ‰§è¡Œshellè„šæœ¬æ£€æµ‹ç£ç›˜ä½¿ç”¨çŽ‡ï¼Œé€šè¿‡åˆ¤æ–­ä½¿ç”¨çŽ‡è¿›è¡Œæ—¥å¿—åˆ é™¤å¹¶å‘Šè­¦ï¼ˆå‘Šè­¦è¿™é‡Œèµ°çš„æ˜¯pythonï¼‰

```raw
# crontab -e, for trigger
0 1,7 * * * /bin/bash /opt/monitor_scripts/disk_monitor.sh
```

```bash
# Description: statistics disk usage, if usage>90 then delete the log before 90 days and alert.
# Author: Jalen

rate=$(df -h | grep "/dev/mapper/wcx_vg-opt" | awk '{print $5}' | cut -d "%" -f 1)

if [ $rate -ge 90 ]
then
   msg="Warning! server 305 disk high usage! now is ${rate}%!"
   echo $msg
   find /opt/logs_backup/ -mtime +90 -exec rm -rf {} \;
   /opt/venv/bin/python /opt/project/disk_monitor.py "$msg"
fi
```

```python
# python script: send alert
import sys

from config import NewConfig
from dashboard.bot import botcommon

if __name__ == '__main__':
    print("Send Alert")
    message = sys.argv[1]
    print(f"The message is {message}")
    room_id = NewConfig.MSG_ROOM
    print(f"The room id is {room_id}")
    botcommon.send_text_to_spark_room(message, room_id)
```
