---
title: JavaScriptçš„å˜é‡åŠå‡½æ•°ï¼ˆå˜é‡æå‡ã€åµŒå¥—ä½œç”¨åŸŸã€æ¡ä»¶è¯­å¥ã€ä¸¥æ ¼æ¨¡å¼ã€IIFEã€é—­åŒ…ã€æ¨¡å—åŒ–ã€thisã€åŸå‹ï¼‰
date: 2017-12-25 10:43:45
tags:
- js
categories:
valine:
  placeholder: "1. æé—®å‰è¯·å…ˆä»”ç»†é˜…è¯»æœ¬æ–‡æ¡£âš¡\n2. é¡µé¢æ˜¾ç¤ºé—®é¢˜ğŸ’¥ï¼Œè¯·æä¾›æ§åˆ¶å°æˆªå›¾ğŸ“¸æˆ–è€…æ‚¨çš„æµ‹è¯•ç½‘å€\n3. å…¶ä»–ä»»ä½•æŠ¥é”™ğŸ’£ï¼Œè¯·æä¾›è¯¦ç»†æè¿°å’Œæˆªå›¾ğŸ“¸ï¼Œç¥é£Ÿç”¨æ„‰å¿«ğŸ’ª"
---

> æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹JavaScriptçš„å˜é‡å‘½åè§„åˆ™ã€ç®€å•ä½¿ç”¨æ–¹å¼åŠä¸€äº›å‡½æ•°çš„ä½¿ç”¨ã€‚

# å‘½åè§„åˆ™

åœ¨JavaScriptä¸­ï¼Œå˜é‡åç§°ï¼ˆåŒ…æ‹¬å‡½æ•°åç§°ï¼‰å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ ‡è¯†ç¬¦ã€‚å½“ä½ è€ƒè™‘ä½¿ç”¨Unicodeç­‰éä¼ ç»Ÿå­—ç¬¦æ—¶ï¼Œæ ‡è¯†ç¬¦ä¸­æœ‰æ•ˆå­—ç¬¦çº¦æŸè§„åˆ™å¯èƒ½ä¼šæœ‰ç‚¹å¤æ‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åªè€ƒè™‘å…¸å‹çš„ASCIIä¸­å®šä¹‰çš„å­—æ¯ã€æ•°å­—ç­‰å…¶ä»–å­—ç¬¦æ—¶ï¼Œåˆ™è§„åˆ™è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚

å°æµ‹è¯•ï¼Œå…ˆçœ‹ä¸€ä¸‹æ±‰å­—å‘½åæ˜¯å¦å¯ä»¥ã€‚

ï¼ˆ1ï¼‰å®šä¹‰å‡½æ•°

```javascript
function å“ˆå“ˆ(){
  return "123";
}
var z = å“ˆå“ˆ();
console.log(z); //  "123"
```

ï¼ˆ2ï¼‰å®šä¹‰å˜é‡

```javascript
var å¤ªé˜³å¤§ä¸å¤§ = "å¤§";
console.info(å¤ªé˜³å¤§ä¸å¤§);  // "å¤§"
```

å¯è§æ±‰å­—å‘½åæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸æ¨èï¼ŒåŸå› å¤§å®¶éƒ½æ‡‚ã€‚

çœ‹ä¸€ä¸‹å…·ä½“çš„å‘½åè§„åˆ™ï¼ˆé€‚ç”¨äºå±æ€§åç§°ä¸å˜é‡æ ‡è¯†ç¬¦ï¼‰ï¼š

- æ ‡è¯†ç¬¦å¿…é¡»ä»¥a-zï¼ŒA-Zï¼Œ$æˆ–_å¼€å¤´ã€‚å®ƒå¯ä»¥åŒ…å«ä»»ä½•è¿™äº›å­—ç¬¦åŠ æ•°å­—0-9ã€‚
- æŸäº›å•è¯ä¸èƒ½ç”¨ä½œå˜é‡ï¼Œä½†å¯ä»¥ä½œä¸ºå±æ€§åç§°ã€‚è¿™äº›å•è¯è¢«ç§°ä¸ºâ€œä¿ç•™å­—â€ï¼ŒåŒ…æ‹¬JSå…³é”®å­—ï¼ˆforï¼Œinï¼Œifç­‰ï¼‰ä»¥åŠnullï¼Œtrueå’Œfalseã€‚

# å˜é‡ä½œç”¨åŸŸ

> å°±æ˜¯ç®€å•è®²ï¼Œä½ å®šä¹‰ä¸€ä¸ªvaræŒ‡å®šçš„å˜é‡ï¼Œå¦‚æœåœ¨å‡½æ•°å†…ï¼Œåˆ™ä½œç”¨åŸŸå°±æ˜¯å½“å‰å‡½æ•°ï¼Œå¦‚æœæ˜¯æ‰€æœ‰å‡½æ•°å¤–éƒ¨ï¼Œé‚£ä¹ˆå°±æ˜¯å…¨å±€ä½œç”¨åŸŸã€‚

# å˜é‡æå‡ï¼ˆHoistingï¼‰

æ— è®ºvarå£°æ˜å‡ºç°åœ¨å“ªä¸€ä¸ªèŒƒå›´å†…ï¼Œè¯¥å£°æ˜çš„å˜é‡è¢«è®¤ä¸ºå±äºå½“å‰æ•´ä¸ªèŒƒå›´ï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªèŒƒå›´å†…éƒ½å¯ä»¥è®¿é—®ã€‚ å°±æ˜¯è¯´æ— è®ºåœ¨å“ªä¸ªä½ç½®å®šä¹‰å˜é‡ï¼Œä»–éƒ½ä¼šæå‡åˆ°ä½œç”¨åŸŸæœ€å‰ç«¯ã€‚

æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªvarå£°æ˜åœ¨å±æ€§è¢«â€œç§»åŠ¨â€åˆ°å®ƒçš„å°é—­èŒƒå›´çš„é¡¶éƒ¨æ—¶ï¼Œè¿™ç§è¡Œä¸ºå°±è¢«ç§°ä¸ºæå‡ã€‚

å¯ä»¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```javascript
var a = 2;
 
foo();					// works because `foo()`
						// declaration is "hoisted"
 
function foo() {
	a = 3;
 
	console.log( a );	// 3
 
	var a;				// declaration is "hoisted"
						// to the top of `foo()`
}
 
console.log( a );	// 2
```

æ³¨æ„ï¼Œå˜é‡æå‡å¹¶ä¸é€šç”¨ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¾é å˜é‡æå‡æ¥ä½¿å˜é‡çš„ä½¿ç”¨èŒƒå›´æ¯”å…¶varå˜é‡å£°æ˜çš„èŒƒå›´æ›´æ—©ï¼ˆä¼šå‡ºç°undefinedç­‰ä¸€ç³»åˆ—ä¸å¯é¢„æµ‹é—®é¢˜ï¼‰ï¼Œè¿™å¯èƒ½ä¼šç»™ç¨‹åºåˆ¶é€ æ··ä¹±ï¼Œéš¾ä»¥ç†è§£ã€‚ä½¿ç”¨å‡½æ•°å£°æ˜è¿™ç§æ–¹å¼åè€Œæ›´ä¸ºæ™®éå’Œå®¹æ˜“è¢«æ¥å—ï¼Œå°±åƒæˆ‘ä»¬åœ¨æ­£å¼å£°æ˜ä¹‹å‰å‡ºç°çš„fooï¼ˆï¼‰è°ƒç”¨ä¸€æ ·ã€‚

å¦‚æœè¿˜æ˜¯ä¸ç†è§£ä»€ä¹ˆæ˜¯å˜é‡ä¸Šå‡ï¼Œè¯·ç§»æ­¥[è¿™é‡Œ](https://www.cnblogs.com/isaboy/p/javascript_hoisting.html)ã€‚

# åµŒå¥—ä½œç”¨åŸŸ

å½“ä½ å£°æ˜ä¸€ä¸ªå˜é‡æ—¶ï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªå˜é‡å°±ä¼šåœ¨å½“å‰ä½œç”¨åŸŸä¸­ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬å½“å‰ä½œç”¨åŸŸä¸­çš„å‡½æ•°åŠå…¶åµŒå¥—çš„å‡½æ•°ï¼Œè¿™ç±»ä¼¼ä¸€ç§ç»§æ‰¿å…³ç³»ï¼Œsonå¯ä»¥è®¿é—®fooï¼Œç„¶è€Œfooå´ä¸èƒ½è®¿é—®son

```javascript
function foo() {
	var a = 1;
 
	function bar() {
		var b = 2;
 
		function baz() {
			var c = 3;
 
			console.log( a, b, c );	// 1 2 3
		}
 
		baz();
		console.log( a, b );		// 1 2
	}
 
	bar();
	console.log( a );				// 1
}
 
foo();
```

å¦‚æœfooæƒ³è¦è®¿é—®sonï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬æƒ³è®©fooè®¿é—®sonä¸­å˜é‡ï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™ç§å®šä¹‰

```javascript
function foo() {
	a = 1;	// `a` not formally declared
}
 
foo();
a;			// 1 -- oops, auto global variable :(
```

è¿™ç§å•çº¯åœ°æƒ³è¦å®ç°å¯ä»¥è®¿é—®çš„æ–¹å¼ï¼Œéå¸¸badçš„ï¼Œè™½ç„¶å®ç°äº†ï¼Œä½†æ˜¯ä¸æå€¡ï¼Œæ˜¯ç¦æ­¢çš„ã€‚è®°ä½ï¼Œä»»ä½•æ—¶åˆ»ï¼Œéƒ½è¦æ­£å¼åœ°å£°æ˜ä½ çš„å˜é‡ã€‚

é™¤äº†åœ¨å‡½æ•°çº§åˆ«ä¸ºå˜é‡åˆ›å»ºå£°æ˜å¤–ï¼ŒES6è¿˜å…è®¸ä½¿ç”¨letå…³é”®å­—å°†å˜é‡å£°æ˜ä¸ºå±äºå„ä¸ªå—ï¼ˆ{..}ï¼‰ã€‚é™¤äº†ä¸€äº›å¾®å¦™çš„ç»†èŠ‚ä¹‹å¤–ï¼ŒèŒƒå›´è§„åˆ™çš„è¡Œä¸ºä¸æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„å‡½æ•°å¤§è‡´ç›¸åŒï¼š

```javascript
function foo() {
	var a = 1;
 
	if (a >= 1) {
		let b = 2;
 
		while (b < 5) {
			let c = b * 2;
			b++;
 
			console.log( a + c );
		}
	}
}
 
foo();  // 5 7 9
```

å¦‚ä¸Šï¼Œbå£°æ˜åœ¨ifè¯­å¥ä»£ç å—ï¼Œæ‰€ä»¥ä»…åœ¨ifä¸­ç”Ÿæ•ˆï¼Œè€Œcåœ¨whileä»£ç å—ä¸­ï¼Œå›ºä»…åœ¨whileä¸­ç”Ÿæ•ˆï¼Œè¿™æ˜¯ä¸€ç§æ›´ç»†ç²’åº¦çš„ä½œç”¨åŸŸæ§åˆ¶ï¼Œæ¨èä½¿ç”¨ï¼Œå¯ä»¥è®©ä½ æ›´å¥½åœ°ç®¡ç†ä½ çš„å˜é‡ã€‚

# æ¡ä»¶è¯­å¥

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹if elseè¯­å¥ï¼Œè¿™ä¸ªå¾ˆå¸¸ç”¨ï¼Œç„¶è€Œæœ‰æ—¶ä½ ä¼šå‘ç°ï¼Œå¦‚æœæ¡ä»¶å¾ˆå¤šï¼Œä½ ä¸å¾—ä¸ä½¿ç”¨å¾ˆå¤šæ¬¡if..else..if...ï¼Œå¦‚ä¸‹

```javascript
if (a == 2) {
	// do something
}
else if (a == 10) {
	// do another thing
}
else if (a == 42) {
	// do yet another thing
}
else {
	// fallback to here
}
```

è¿™æ—¶æˆ‘ä»¬ä¼šè§‰å¾—å¾ˆå•°å—¦ï¼ˆverboseï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å°è¯•ä½¿ç”¨switch

```javascript
switch (a) {
	case 2:
		// do something
		break;
	case 10:
		// do another thing
		break;
	case 42:
		// do yet another thing
		break;
	default:
		// fallback to here
}
```

ä½†æ˜¯æ³¨æ„ï¼Œåœ¨ä½¿ç”¨switchæ—¶ï¼Œå¿…è¦æ—¶å¿…é¡»å­˜åœ¨breakåšç»“æŸï¼ŒåŠæ—¶è·³å‡ºï¼Œå¦åˆ™å½“ä½ çš„æ¡ä»¶æ»¡è¶³ç¬¬ä¸€ä¸ªcaseæ—¶ï¼Œå¥¹è¿˜ä¼šè·³åˆ°ä¸‹ä¸€ä¸ªcaseä¸­ï¼Œè¿™ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªcaseçš„æ“ä½œï¼Œä¼šé€ æˆæ„å¤–ï¼Œä½†æ˜¯æŸäº›æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦è¿™æ ·åšï¼Œé‚£ä¾¿å¯ä»¥ä¸¢å¼ƒbreakã€‚

```javascript
var a = 2;
switch (a) {
	case 2:
        console.log("haha");
	case 10:
		console.log("hehe");
		break;
	case 42:
		console.log("xixi");
		break;
	default:
		console.log("ä½ ç¬‘å•¥");
}
```

ä¸Šé¢çš„ä¾‹å­ä¼šæ‰“å°ä¿©å€¼ï¼Œä¸€ä¸ªæ˜¯"haha",ä¸€ä¸ªæ˜¯"hehe",
å½“ç„¶ï¼ŒJavaScriptä¸­è¿˜æœ‰ä¸€ç§ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå³

```javascript
var a = 42;
 
var b = (a > 41) ? "hello" : "world";
 
// similar to:
 
// if (a > 41) {
//    b = "hello";
// }
// else {
//    b = "world";
// }
```

æ¡ä»¶è¿ç®—ç¬¦ä¸ä¸€å®šæ˜¯åœ¨èµ‹å€¼ä¸­ä½¿ç”¨ï¼Œä½†è¿™ç»å¯¹æ˜¯æœ€å¸¸ç”¨çš„ç”¨æ³•ã€‚

# ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict Modeï¼‰

ES5ä¸ºè¯­è¨€å¢åŠ äº†ä¸€ç§â€œä¸¥æ ¼æ¨¡å¼â€ï¼Œä»è€ŒåŠ å¼ºäº†æŸäº›è¡Œä¸ºçš„è§„åˆ™ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›é™åˆ¶è¢«è®¤ä¸ºæ˜¯ä¿æŒä»£ç æ›´å®‰å…¨å’Œæ›´åˆé€‚çš„æ–¹å¼ã€‚

å¦å¤–ï¼Œéµå¾ªä¸¥æ ¼çš„æ¨¡å¼ä½¿å¾—ä½ çš„ä»£ç é€šå¸¸å¯ä»¥è¢«å¼•æ“æ›´å¥½åœ°ä¼˜åŒ–ã€‚

ä¸¥æ ¼æ¨¡å¼æ˜¯ä»£ç çš„ä¸€å¤§æ”¹è¿›ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶ç”¨äºæ‰€æœ‰ç¨‹åºã€‚ æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸¥æ ¼æ¨¡å¼æ¥æ‰§è¡Œå•ä¸ªå‡½æ•°æˆ–æ•´ä¸ªæ–‡ä»¶ï¼Œå…·ä½“å–å†³äºç¼–è¯‘æŒ‡ç¤ºçš„ä½ç½®ï¼š

```javascript
function foo() {
	"use strict";
 
	// this code is strict mode
 
	function bar() {
		// this code is strict mode
	}
}
 
// this code is not strict mode
```

å’Œä¸‹é¢æ¯”è¾ƒä¸€ä¸‹

```javascript
"use strict";
 
function foo() {
	// this code is strict mode
 
	function bar() {
		// this code is strict mode
	}
}
 
// this code is strict mode
```

ä¸¥æ ¼æ¨¡å¼ä¸å…è®¸çœç•¥varè€Œç›´æ¥å®šä¹‰å…¨å±€å˜é‡ï¼Œå¦‚ä¸‹ä¼šæç¤ºå¼‚å¸¸

```javascript
function foo() {
	"use strict";	// turn on strict mode
	a = 1;			// `var` missing, ReferenceError
}
 
foo();
```

ä¸¥æ ¼æ¨¡å¼æ˜¯JavaScriptæœªæ¥å‘å±•çš„æ–¹å‘ï¼Œä¸€å®šè¦é‡è§†åœ¨ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼æ—¶é‡åˆ°çš„å¼‚å¸¸ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯ä»¥åJavaScriptå°†è¦æ”¹å˜çš„ã€‚

# å°†å‡½æ•°ä½œä¸ºå˜é‡å€¼

çœ‹ä¸¤ä¸ªä¾‹å­

```javascript
var foo = function() {
	// ..
};
 
var x = function bar(){
	// ..
};
```

ä¸Šé¢ä¸¤ä¸ªä¾‹å­æœ‰åŒºåˆ«ï¼Œç¬¬ä¸€ä¸ªfooæŒ‡å‘çš„æ˜¯åŒ¿åå‡½æ•°ï¼Œè€Œåä¸€ä¸ªä¸æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡åŒ¿åå‡½æ•°èµ‹å€¼çš„æƒ…å†µè¿˜æ˜¯æ¯”è¾ƒå¤šï¼Œä½†æˆ‘ä»¬æ›´æ¨èä¸ºå…¶æä¾›æŒ‡å®šå‘½åçš„èµ‹å€¼æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒç§ã€‚

# ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆImmediately Invoked Function Expressions (IIFEs)ï¼‰

æˆ–ç§°ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå°±æ˜¯è¯´ç›´æ¥å¯ä»¥è‡ªåŠ¨æ‰§è¡Œï¼Œå¹¶è¾“å‡ºæˆ–æä¾›ä¸€ä¸ªä¿¡æ¯åé¦ˆã€‚å¦‚

```javascript
(function foo(){
	console.log( "Hello!" );  
})();
```

ä¸Šé¢å‡½æ•°æ‰§è¡Œåï¼Œä¼šç›´æ¥æ‰“å°å€¼"Helloï¼"

ç„¶è€Œæ™®é€šçš„å‡½æ•°å‘¢ï¼Ÿ

```javascript
function foo(){
  console.log("Hello!");
}
```

å¥¹æ˜¯ä¸ä¼šè‡ªå·±å»æ‰§è¡Œçš„ï¼Œéœ€è¦èµ‹äºˆä¸€ä¸ªå˜é‡ï¼Œæˆ–è€…ç­‰å¾…ç€è¢«è°ƒç”¨ã€‚

å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ä¸‹é¢çš„æ™®é€šå‡½æ•°ä¸ç«‹å³æ‰§è¡Œå‡½æ•°ï¼š

```javascript
function foo() { .. }
 
// `foo` function reference expression,
// then `()` executes it
foo();
 
// `IIFE` function expression,
// then `()` executes it
(function IIFE(){ .. })();
```

åœ¨å˜é‡ä½œç”¨åŸŸä¸Šï¼Œç«‹å³æ‰§è¡Œå‡½æ•°ä¸­å®šä¹‰çš„å˜é‡å’Œå¤–éƒ¨å˜é‡æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“

```javascript
var a = 42;
 
(function IIFE(){
	var a = 10;
	console.log( a );	// 10
})();
 
console.log( a );		// 42
```

ç«‹å³æ‰§è¡Œå‡½æ•°å¯ä»¥åŒ…å«è¿”å›å€¼ã€‚

```javascript
var x = (function IIFE(){
	return 42;
})();
 
x;	// 42
```

# é—­åŒ…ï¼ˆClosureï¼‰

æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥è¯»å–å…¨å±€å˜é‡ï¼Œè€Œåœ¨å‡½æ•°å¤–éƒ¨è‡ªç„¶æ— æ³•è¯»å–å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼ˆé™¤äº†æ²¡æœ‰varä¿®é¥°çš„å…¨å±€å˜é‡ï¼‰ï¼Œè€Œæˆ‘ä»¬æœ‰æ—¶ååˆéœ€è¦ä»å¤–éƒ¨è·å–æŸä¸ªå±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä»å¤–éƒ¨è¯»å–å±€éƒ¨å˜é‡å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å°è¯•ç€åšè¿™æ ·ä¸€ä¸ªæ“ä½œï¼šåœ¨å‡½æ•°çš„å†…éƒ¨ï¼Œå†å®šä¹‰ä¸€ä¸ªå‡½æ•°

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å…ˆçœ‹ä¸ªä¾‹å­ï¼š

```javascript
function foo(){
 
ã€€ã€€ã€€ã€€var m = 123;
 
ã€€ã€€ã€€ã€€function bar(){
ã€€ã€€ã€€ã€€ã€€ã€€return m;
ã€€ã€€ã€€ã€€}
 
ã€€ã€€ã€€ã€€return bar;
}
 
var result = foo();
 
result();
```

ä¸Šé¢fooå‡½æ•°ä¸­å®šä¹‰çš„barå‡½æ•°ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚

å¤§å®¶å¯ä»¥å°†é—­åŒ…çœ‹ä½œæ˜¯ä¸€ç§â€œè¢«è®°å¿†â€çš„æ–¹å¼ï¼Œå³ä½¿å‡½æ•°è¿è¡Œå®Œæ¯•ï¼Œä¹Ÿå¯ä»¥ç»§ç»­è®¿é—®å‡½æ•°çš„ä½œç”¨åŸŸï¼ˆå˜é‡ï¼‰ã€‚æœ‰æ—¶å€™è¿™è¿˜æ˜¯ä¼šè®©æˆ‘ä»¬å¾ˆç–‘æƒ‘ï¼Œå¯ä»¥å†çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ï¼š

```javascript
function makeAdder(x) {
	// parameter `x` is an inner variable
 
	// inner function `add()` uses `x`, so
	// it has a "closure" over it
	function add(y) {
		return y + x;
	};
 
	return add;
}
// `plusOne` gets a reference to the inner `add(..)`
// function with closure over the `x` parameter of
// the outer `makeAdder(..)`
var plusOne = makeAdder( 1 );
 
// `plusTen` gets a reference to the inner `add(..)`
// function with closure over the `x` parameter of
// the outer `makeAdder(..)`
var plusTen = makeAdder( 10 );
 
plusOne( 3 );		// 4  <-- 1 + 3
plusOne( 41 );		// 42 <-- 1 + 41
 
plusTen( 13 );		// 23 <-- 10 + 13
```

å½“ä½ æ‰§è¡Œè¿‡åï¼Œå‘ç°plusOne( 3 )çš„å€¼ä¸º4ï¼ŒplusOne( 41 )çš„å€¼æ˜¯42ï¼ŒplusTen( 13 )çš„å€¼æ˜¯23ï¼Œ

- å½“æˆ‘ä»¬è°ƒç”¨makeAdderï¼ˆ1ï¼‰æ—¶ï¼Œæˆ‘ä»¬è¿”å›ä¸€ä¸ªå¯¹å®ƒçš„å†…éƒ¨addï¼ˆ..ï¼‰çš„å¼•ç”¨ï¼Œå®ƒå°†xè®°ä¸º1.æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°å¼•ç”¨ç§°ä¸ºplusOneï¼ˆ..ï¼‰ã€‚ 
- å½“æˆ‘ä»¬è°ƒç”¨makeAdderï¼ˆ10ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°å¦ä¸€ä¸ªå®ƒçš„å†…éƒ¨addï¼ˆ..ï¼‰çš„å¼•ç”¨ï¼Œå®ƒå°†xè®°ä¸º10.æˆ‘ä»¬ç§°è¿™ä¸ªå‡½æ•°ä¸ºå¼•ç”¨plusTenï¼ˆ..ï¼‰ã€‚ 
- å½“æˆ‘ä»¬è°ƒç”¨plusOneï¼ˆ3ï¼‰æ—¶ï¼Œå®ƒå°†3ï¼ˆå®ƒçš„å†…éƒ¨yï¼‰åŠ åˆ°1ï¼ˆè¢«xè®°ä½ï¼‰ï¼Œæˆ‘ä»¬å¾—åˆ°4ç»“æœã€‚ 
- å½“æˆ‘ä»¬å‘¼å«åŠ åï¼ˆ13ï¼‰æ—¶ï¼Œå®ƒå°†åä¸‰ï¼ˆå®ƒçš„å†…éƒ¨yï¼‰åŠ åˆ°10ï¼ˆè¢«xè®°ä½ï¼‰ï¼Œç»“æœæˆ‘ä»¬å¾—åˆ°23ã€‚

é—­åŒ…æœ‰ä¸‹é¢ä¸¤ä¸ªç”¨é€”ï¼Œç¬¬ä¸€ä¸ªæˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»è¯´æ˜äº†ï¼š

- ä¸€ä¸ªæ˜¯å‰é¢æåˆ°çš„å¯ä»¥è¯»å–å‡½æ•°å†…éƒ¨çš„å˜é‡
- å¦ä¸€ä¸ªå°±æ˜¯è®©è¿™äº›å˜é‡çš„å€¼å§‹ç»ˆä¿æŒåœ¨å†…å­˜ä¸­ï¼ˆå°å¿ƒä¹Ÿä¼šå†…å­˜æ³„æ¼å“¦ï¼‰

å¦‚æœè¿˜æ˜¯ä¸ç†è§£ï¼Œå¯ä»¥å‚è€ƒ[é˜®ä¸€å³°å¤§ä½¬çš„åšå®¢](http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html)ã€‚

# æ¨¡å—åŒ–

å…ˆçœ‹ä¸€ä¸ªä¾‹å­

```javascript
function User(){
	var username, password;
 
	function doLogin(user,pw) {
		username = user;
		password = pw;
 
		// do the rest of the login work
	}
 
	var publicAPI = {
		login: doLogin
	};
 
	return publicAPI;
}
 
// create a `User` module instance
var fred = User();
 
fred.login( "fred", "12Battery34!" );
```

Userï¼ˆï¼‰å‡½æ•°ä½œä¸ºä¸€ä¸ªä¾›å¤–éƒ¨è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒä¿å­˜ç€å˜é‡çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åŠå†…éƒ¨çš„doLoginï¼ˆï¼‰å‡½æ•°ã€‚è¿™äº›éƒ½æ˜¯è¯¥ç”¨æˆ·æ¨¡å—çš„å†…éƒ¨ç»†èŠ‚ï¼Œæ— æ³•ä»å¤–éƒ¨è®¿é—®ã€‚ 

è­¦å‘Šï¼š

- æˆ‘ä»¬ä¸æ‰“ç®—åœ¨è¿™é‡Œè°ƒç”¨å¹¶äº§ç”Ÿä¸€ä¸ªnew Userï¼ˆï¼‰ï¼Œå°½ç®¡äº‹å®ä¸Šå¤§å¤šæ•°è¯»è€…å¯èƒ½çœ‹èµ·æ¥æ›´å¸¸è§ã€‚ 
- Userï¼ˆï¼‰åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸æ˜¯è¦å®ä¾‹åŒ–çš„ç±»ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç®—æ˜¯æ­£å¸¸è°ƒç”¨ã€‚ä½¿ç”¨newæ˜¯ä¸åˆé€‚çš„ï¼Œå¹¶ä¸”æµªè´¹èµ„æºã€‚ 
- æˆ‘ä»¬é¦–å…ˆæ‰§è¡ŒUserï¼ˆï¼‰ï¼Œæ­¤æ—¶ä¼šåˆ›å»ºUserå‡½æ•°çš„ä¸€ä¸ªå®ä¾‹ - åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ä½œç”¨åŸŸï¼Œä»è€Œåˆ›å»ºæ¯ä¸ªå­˜åœ¨æ­¤ä½œç”¨åŸŸçš„å†…éƒ¨å˜é‡/å‡½æ•°çš„å…¨æ–°å‰¯æœ¬ã€‚æˆ‘ä»¬å°†è¿™ä¸ªå®ä¾‹åˆ†é…ç»™fredã€‚å¦‚æœæˆ‘ä»¬å†æ¬¡è¿è¡ŒUserï¼ˆï¼‰ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹äºfredçš„æ–°å®ä¾‹ï¼Œè¿™æ˜¯ä¸å¯å–çš„ã€‚ 
- å†…éƒ¨çš„doLoginï¼ˆï¼‰å‡½æ•°æœ‰ä¸€ä¸ªå…³äºç”¨æˆ·åå’Œå¯†ç çš„é—­åŒ…ï¼Œè¿™æ„å‘³ç€å³ä½¿åœ¨Userï¼ˆï¼‰å‡½æ•°å®Œæˆè¿è¡Œåï¼Œå®ƒä»ç„¶ä¿ç•™å¯¹å®ƒä»¬çš„è®¿é—®ã€‚ 
- publicAPIæ˜¯ä¸€ä¸ªæ‹¥æœ‰ä¸€ä¸ªå±æ€§/æ–¹æ³•çš„å¯¹è±¡ï¼Œloginæ˜¯ä¸€ä¸ªå¯¹doLoginï¼ˆï¼‰å‡½æ•°çš„å¼•ç”¨ã€‚å½“æˆ‘ä»¬ä»Userï¼ˆï¼‰è¿”å›publicAPIæ—¶ï¼Œå®ƒæˆä¸ºæˆ‘ä»¬è°ƒç”¨çš„fredçš„å®ä¾‹ã€‚ æ­¤æ—¶ï¼Œå¤–éƒ¨çš„Userï¼ˆï¼‰å‡½æ•°å·²ç»å®Œæˆæ‰§è¡Œã€‚
- é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä¼šè®¤ä¸ºåƒç”¨æˆ·åå’Œå¯†ç çš„å†…éƒ¨å˜é‡å·²ç»æ¶ˆå¤±ã€‚ä½†æ˜¯åœ¨è¿™é‡Œä»–ä»¬æ²¡æœ‰ï¼Œå› ä¸ºåœ¨loginï¼ˆï¼‰å‡½æ•°ä¸­æœ‰ä¸€ä¸ªé—­åŒ…è®©å®ƒä»¬æ´»ç€ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è°ƒç”¨fred.loginï¼ˆ..ï¼‰ - å°±åƒè°ƒç”¨å†…éƒ¨çš„doLoginï¼ˆ..ï¼‰ä¸€æ · - å®ƒä»ç„¶å¯ä»¥è®¿é—®ç”¨æˆ·åå’Œå¯†ç çš„å†…éƒ¨å˜é‡ã€‚ 

# thisæ ‡è¯†

åœ¨JavaScriptä¸­ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°é‡Œé¢æœ‰è¿™ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨é€šå¸¸æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯æŒ‡å‘å“ªä¸ªå¯¹è±¡å–å†³äºå‡½æ•°çš„å…·ä½“è°ƒç”¨æ–¹å¼ã€‚

å¦‚ï¼š

```javascript
function foo() {
	console.log( this.bar );
}
 
var bar = "global";
 
var obj1 = {
	bar: "obj1",
	foo: foo
};
 
var obj2 = {
	bar: "obj2"
};
 
// --------
 
foo();				// "global"
obj1.foo();			// "obj1"
foo.call( obj2 );		// "obj2"
new foo();			// undefined
```

ä¸‹é¢è§£é‡Šä¸€ä¸‹ä»£ç ï¼š

1. è¿™æ®µä»£ç ä¸­ï¼Œfooï¼ˆï¼‰çš„æœ€ç»ˆè®¾ç½®ä¸ºéä¸¥æ ¼æ¨¡å¼ä¸‹çš„å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥â€œglobalâ€æ˜¯æ­¤è°ƒç”¨æ—¶çš„ç»“æœã€‚è€Œå¦‚æœåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis.barå…¶å®æ˜¯undefinedçš„ï¼Œå¹¶ä¸”åœ¨è®¿é—®barå±æ€§æ—¶ä¼šå‡ºé”™ ã€‚
2. obj1.fooï¼ˆï¼‰å°†å…¶è®¾ç½®ä¸ºobj1å¯¹è±¡ã€‚
3. foo.callï¼ˆobj2ï¼‰å°†å…¶è®¾ç½®ä¸ºobj2å¯¹è±¡ã€‚
4. new fooï¼ˆï¼‰å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªå…¨æ–°çš„ç©ºå¯¹è±¡ã€‚

# åŸå‹æœºåˆ¶

JavaScriptä¸­çš„åŸå‹æœºåˆ¶æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬è¿™é‡Œåªç„ä¸€çœ¼å³å¯ã€‚

å‡è®¾æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå½“æˆ‘ä»¬åœ¨å¯¹è±¡ä¸Šå¼•ç”¨å¦ä¸€ä¸ªå±æ€§æ—¶ï¼Œå¦‚æœè¯¥å±æ€§ä¸å­˜åœ¨ï¼ŒJavaScriptå°†è‡ªåŠ¨ä½¿ç”¨è¯¥å¯¹è±¡çš„å†…éƒ¨åŸå‹å¼•ç”¨æ¥æŸ¥æ‰¾å¦ä¸€ä¸ªå¯¹è±¡ä»¥æŸ¥æ‰¾å±æ€§ã€‚å½“å±æ€§ç¼ºå¤±æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…¶çœ‹ä½œæ˜¯åå¤‡èµ„æºã€‚

è€ƒè™‘ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```javascript
var foo = {
	a: 42
};
 
// create `bar` and link it to `foo`
var bar = Object.create( foo );
 
bar.b = "hello world";
 
bar.b;		// "hello world"
bar.a;		// 42 <-- delegated to `foo`
```

å¯ä»¥æƒ³è±¡æˆä¸‹é¢è¿™å¹…å›¾å»ç†è§£

![](../images/jslearn01.png)

aå±æ€§å®é™…ä¸Šå¹¶ä¸å­˜åœ¨äºbarå¯¹è±¡ä¸Šï¼Œä½†æ˜¯å› ä¸ºbaræ˜¯ä¸fooåŸå‹é“¾æ¥çš„ï¼Œæ‰€ä»¥JavaScriptä¼šè‡ªåŠ¨å›é€€åˆ°åœ¨fooå¯¹è±¡ä¸Šå¯»æ‰¾å®ƒçš„ä½ç½®ã€‚

è¿™ç§è”ç³»å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚è¿™ç§æ–¹å¼å¼•å‘çš„æœ€å¸¸è§çš„å¼Šç«¯å°±æ˜¯æ»¥ç”¨ - å°±æ˜¯è¯•å›¾ç”¨â€œç»§æ‰¿â€æ¨¡ä»¿/ä¼ªé€ ä¸€ä¸ªâ€œç±»â€æœºåˆ¶ã€‚

ä½†æ›´è‡ªç„¶çš„åº”ç”¨åŸå‹æœºåˆ¶çš„æ–¹å¼æ˜¯ä¸€ç§ç§°ä¸ºâ€œè¡Œä¸ºå§”æ‰˜â€çš„æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ç‰¹æ„è®¾è®¡ä½ çš„é“¾æ¥å¯¹è±¡ï¼Œä»¥ä¾¿èƒ½å¤Ÿå°†æ‰€éœ€è¡Œä¸ºçš„ä¸€éƒ¨åˆ†å§”æ‰˜ç»™å¦ä¸€ä¸ªã€‚

