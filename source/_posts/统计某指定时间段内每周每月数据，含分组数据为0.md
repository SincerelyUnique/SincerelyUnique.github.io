---
title: oracleç»Ÿè®¡æŸæŒ‡å®šæ—¶é—´æ®µå†…æ¯å‘¨æ¯æœˆæ•°æ®ï¼Œå«åˆ†ç»„æ•°æ®ä¸º0
date: 2019-02-18 14:38:17
tags:
- oracle
- sql
categories:
valine:
  placeholder: "1. æé—®å‰è¯·å…ˆä»”ç»†é˜…è¯»æœ¬æ–‡æ¡£âš¡\n2. é¡µé¢æ˜¾ç¤ºé—®é¢˜ğŸ’¥ï¼Œè¯·æä¾›æ§åˆ¶å°æˆªå›¾ğŸ“¸æˆ–è€…æ‚¨çš„æµ‹è¯•ç½‘å€\n3. å…¶ä»–ä»»ä½•æŠ¥é”™ğŸ’£ï¼Œè¯·æä¾›è¯¦ç»†æè¿°å’Œæˆªå›¾ğŸ“¸ï¼Œç¥é£Ÿç”¨æ„‰å¿«ğŸ’ª"
---

1. æŒ‰æœˆ

(1) ç®€å•åˆ†ç»„æŸ¥è¯¢

```sql
-- åˆ†ç»„åæŸ¥è¯¢æ•°æ®: ä»…1æœˆä»½6æ¡ï¼Œ2æœˆä»½å› ä¸ºä¸å­˜åœ¨è®°å½•ï¼Œæ²¡æœ‰æ˜¾ç¤º
SELECT to_char(r.sys_created_on, 'yyyy-mm') AS create_time, count(*) AS quantity
  FROM table_r r,table_g g
 WHERE r.assignment_group = g.sys_id 
       AND g.name = 'Provisioning Ops'
   AND r.sys_created_on BETWEEN 
                TO_DATE('2019-01-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
                TO_DATE('2019-02-18 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
 GROUP BY to_char(r.sys_created_on, 'yyyy-mm')
 ORDER BY to_char(r.sys_created_on, 'yyyy-mm');
```

![statistics01](../images/statistics01.png)

ï¼ˆ2ï¼‰æ„å»ºè™šæ‹Ÿæœˆä»½è¡¨

```sql
-- è™šæ‹Ÿæœˆä»½
SELECT TO_CHAR(ADD_MONTHS(TO_DATE(substr('2019-01-19 23:59:59', 1, 7), 'yyyy-MM'), ROWNUM - 1),
               'yyyy-MM') AS create_time
  FROM DUAL
CONNECT BY ROWNUM <=
           months_between(TO_DATE(substr('2019-02-18 23:59:59', 1, 7), 'YYYY-MM'),
                          TO_DATE(substr('2019-01-19 23:59:59', 1, 7), 'yyyy-MM')) + 1;
```

![statistics02](../images/statistics02.png)

ï¼ˆ3ï¼‰è¿æ¥ååˆ†ç»„æŸ¥è¯¢ï¼š

```sql
-- å·¦è¿æ¥
SELECT a.create_time as create_time, nvl(b.quantity, 0) as quantity
  FROM (SELECT TO_CHAR(ADD_MONTHS(TO_DATE(substr('2019-01-19 23:59:59', 1, 7),
                                          'yyyy-MM'),
                                  ROWNUM - 1),
                       'yyyy-MM') AS create_time
          FROM DUAL
        CONNECT BY ROWNUM <=
                   months_between(TO_DATE(substr('2019-02-18 23:59:59', 1, 7),
                                          'YYYY-MM'),
                                  TO_DATE(substr('2019-01-19 23:59:59', 1, 7),
                                          'yyyy-MM')) + 1) a
  LEFT JOIN (SELECT to_char(r.sys_created_on, 'yyyy-mm') AS create_time,
                    count(*) AS quantity
               FROM table_r r, table_g g
              WHERE r.assignment_group = g.sys_id
                AND g.name = 'Provisioning Ops'
                AND r.sys_created_on BETWEEN
                    TO_DATE('2019-01-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
                    TO_DATE('2019-02-18 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
              GROUP BY to_char(r.sys_created_on, 'yyyy-mm')
              ORDER BY to_char(r.sys_created_on, 'yyyy-mm')) b
    ON a.create_time = b.create_time
 ORDER BY a.create_time
```

![stastistics03](../images/stastistics03.png)

2. æŒ‰å‘¨

(1) ç®€å•åˆ†ç»„æŸ¥è¯¢

```sql
-- åˆ†ç»„æŸ¥è¯¢ï¼šä»…æœ‰2å‘¨å­˜åœ¨è®°å½•ï¼Œ2019-01-14å’Œ2019-01-21åˆ†åˆ«ä¸ºè¿™ä¸¤å‘¨çš„å‘¨ä¸€
SELECT to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2), 'YYYY-MM-DD') create_time,
       count(*) quantity
  FROM table_r r, table_g g
 WHERE r.assignment_group = g.sys_id
   AND g.name = 'Provisioning Ops'
   AND r.sys_created_on BETWEEN
       TO_DATE('2019-01-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
       TO_DATE('2019-02-18 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
 GROUP BY to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2), 'YYYY-MM-DD')
 ORDER BY to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2), 'YYYY-MM-DD')
```

![stastistics04](../images/stastistics04.png)

(2) æ„å»ºè™šæ‹Ÿå‘¨æ•°è¡¨ï¼š

```sql
-- è™šæ‹Ÿå‘¨æ•°
SELECT to_char(trunc(TO_DATE('2019-01-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS') +
                     (ROWNUM - 1) * 7,
                     'd') + 1,
               'yyyy-MM-dd') AS create_time
  FROM DUAL
CONNECT BY ROWNUM <=
           (TRUNC(TO_DATE('2019-02-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
                  'IW') -
           TRUNC(TO_DATE('2019-01-19 23:59:59', 'YYYY-MM-DD HH24:MI:SS'),
                  'IW')) / 7 + 1
```

![stastistics05](../images/stastistics05.png)

(3) è¿æ¥ååˆ†ç»„æŸ¥è¯¢ï¼š

```sql
-- å·¦è¿æ¥
SELECT a.create_time as create_time, nvl(b.quantity, 0) as quantity
  FROM (SELECT to_char(trunc(TO_DATE('2019-01-19 00:00:00',
                                     'YYYY-MM-DD HH24:MI:SS') +
                             (ROWNUM - 1) * 7,
                             'd') + 1,
                       'yyyy-MM-dd') AS create_time
          FROM DUAL
        CONNECT BY ROWNUM <=
                   (TRUNC(TO_DATE('2019-02-18 00:00:00',
                                  'YYYY-MM-DD HH24:MI:SS'),
                          'IW') - TRUNC(TO_DATE('2019-01-19 23:59:59',
                                                 'YYYY-MM-DD HH24:MI:SS'),
                                         'IW')) / 7 + 1) a
  LEFT JOIN (SELECT to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2),
                            'YYYY-MM-DD') create_time,
                    count(*) quantity
               FROM table_r r, table_g g
              WHERE r.assignment_group = g.sys_id
                AND g.name = 'Provisioning Ops'
                AND r.sys_created_on BETWEEN
                    TO_DATE('2019-01-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS') AND
                    TO_DATE('2019-02-18 23:59:59', 'YYYY-MM-DD HH24:MI:SS')
              GROUP BY to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2),
                               'YYYY-MM-DD')
              ORDER BY to_char(next_day(r.sys_created_on + 15 / 24 - 7, 2),
                               'YYYY-MM-DD')) b
    ON a.create_time = b.create_time
 ORDER BY a.create_time
```

![stastics06](../images/stastics06.png)


å‚è€ƒï¼š

å‘¨æ•°è½¬æ—¥æœŸï¼š https://www.cnblogs.com/Innogen/p/8269092.html

æ„å»ºè™šæ‹Ÿè¡¨ï¼šhttps://www.cnblogs.com/LLSutdy/p/7998322.html

æ•´ä½“å‚è€ƒï¼šhttps://blog.csdn.net/weixin_36150793/article/details/81607574

çº æ­£ï¼š

æŒ‰å‘¨æŸ¥è¯¢é‚£æ¡sqlæµ‹è¯•æœ‰é—®é¢˜ï¼Œæœ¬åœ°æµ‹æ—¶å‘ç°å¦‚ä¸‹é—®é¢˜ï¼š

```sql
select to_char(next_day(TO_DATE('2019-02-17 08:59:00', 'YYYY-MM-DD HH24:MI:SS') + 15 / 24 - 7, 2), 'YYYY-MM-DD'),
       to_char(next_day(TO_DATE('2019-02-17 09:00:00', 'YYYY-MM-DD HH24:MI:SS') + 15 / 24 - 7, 2), 'YYYY-MM-DD'),
       dbtimezone
  from dual;
```

![stastics07](../images/stastics07.png)


æœ¬äººçŒœæµ‹åº”è¯¥ç®—æ³•è¿˜æ˜¯è¿™ä¸ªç®—æ³•ï¼Œåªæ˜¯å’Œæ—¶åŒºå…³è”ä¸Šäº†ï¼Œå› ä¸ºæœ¬å…¬å¸DBæ—¶åŒºç»Ÿä¸€é‡‡ç”¨UTCæ—¶é—´ï¼ˆ=GMTæ—¶é—´ï¼Œå…¶å®ä»–ä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼‰ï¼Œæ‰€ä»¥æ‰¾äº†ä¸€ä¸ªå‘¨çš„äº¤å‰ç‚¹ç”¨ç¬¨æ–¹æ³•æµ‹è¯•äº†ä¸€ä¸‹ï¼ˆå°±æ˜¯ä¸€ä¸ªä¸ªæ”¹æ•°å­—ï¼Œå¥½ç¬¨å•Šï¼Œæ¯•ç«Ÿç®—æ³•æ²¡çœ‹æ‡‚ï¼‰ï¼Œsqlå¦‚ä¸‹ï¼š

```sql
select to_char(next_day(TO_DATE('2019-02-16 23:59:59', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a1,
       to_char(next_day(TO_DATE('2019-02-17 00:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a2,
       to_char(next_day(TO_DATE('2019-02-17 02:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a3,
       to_char(next_day(TO_DATE('2019-02-17 04:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a4,
       to_char(next_day(TO_DATE('2019-02-17 06:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a5,
       to_char(next_day(TO_DATE('2019-02-17 08:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a6,
       to_char(next_day(TO_DATE('2019-02-17 10:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a7,
       to_char(next_day(TO_DATE('2019-02-17 12:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a8,
       to_char(next_day(TO_DATE('2019-02-17 14:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a9,
       to_char(next_day(TO_DATE('2019-02-17 16:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a10,
       to_char(next_day(TO_DATE('2019-02-17 18:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a11,
       to_char(next_day(TO_DATE('2019-02-17 20:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a12,
       to_char(next_day(TO_DATE('2019-02-17 22:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a13,
       to_char(next_day(TO_DATE('2019-02-17 23:59:59', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a14,
       to_char(next_day(TO_DATE('2019-02-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a15,
       to_char(next_day(TO_DATE('2019-02-18 23:59:59', 'YYYY-MM-DD HH24:MI:SS') + 0 / 24 - 7, 2), 'YYYY-MM-DD') as a16,
       dbtimezone
  from dual;
```

![stastics08](../images/stastics08.png)

å¯ä»¥çœ‹åˆ°æ˜æ˜¾æœ‰ä¸ªæ—¶é—´çš„è·³å˜ï¼Œæ­£å¥½å’Œæ—¥æœŸå¯¹ä¸Šäº†ï¼ 
