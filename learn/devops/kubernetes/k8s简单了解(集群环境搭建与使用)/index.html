<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="MlAWwzcGEsG8nn2V34gojElRFcnHeEgBvIS8Ek1LQ0c"><meta name="msvalidate.01" content="8BDA269F1F25AB9AB2160E377B2334C5"><link rel="alternate" type="application/rss+xml" title="Follow your heart" href="http://jalen.site/rss.xml"><link rel="alternate" type="application/atom+xml" title="Follow your heart" href="http://jalen.site/atom.xml"><link rel="alternate" type="application/json" title="Follow your heart" href="http://jalen.site/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="linux,k8s"><link rel="canonical" href="http://jalen.site/learn/devops/kubernetes/k8s%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3(%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8)/"><title>centos k8s 简单了解 (集群环境搭建与使用) - Kubernetes - DevOPS - 学习 | Jalen's Blog = Follow your heart = A happy life</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">centos k8s 简单了解 (集群环境搭建与使用)</h1><div class="meta"><span class="item" title="创建时间：2021-07-29 12:22:36"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-07-29T12:22:36+08:00">2021-07-29</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>22k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>20 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jalen's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/01/05/uVxdPYkbWySC6et.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/rwF2jq5NlJe3pom.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/wrgSWye2fjC1pAm.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/CspI9iVgn7WBrxF.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/ltAiNoEJ9HG1PBc.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/MNQSKIuPV9xw5OT.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/devops/" itemprop="item" rel="index" title="分类于 DevOPS"><span itemprop="name">DevOPS</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/devops/Kubernetes/" itemprop="item" rel="index" title="分类于 Kubernetes"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://jalen.site/learn/devops/kubernetes/k8s%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3(%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8)/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Jalen Chu"><meta itemprop="description" content="A happy life, ٩(●˙▿˙●)۶…⋆ฺ ->"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Follow your heart"></span><div class="body md" itemprop="articleBody"><h1 id="centos-k8s简单了解集群环境搭建与使用"><a class="anchor" href="#centos-k8s简单了解集群环境搭建与使用">#</a> centos k8s 简单了解 (集群环境搭建与使用)</h1><p>环境说明：windows10，vmware16 Pro 虚拟机，centos7.6 镜像，一共装两台虚拟机模拟（1 台 master 和 1 台 node，实际应更多）</p><p>虚拟机网络使用桥接模式（自动），每个虚拟机配置为硬盘 20G，内存 2G，处理器 2 个</p><h2 id="安装kubeadm-kubeletkubectl"><a class="anchor" href="#安装kubeadm-kubeletkubectl">#</a> 安装 kubeadm， kubelet，kubectl</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># swapoff -a   # 禁用虚拟内存</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat &lt;&lt;EOF > /etc/yum.repos.d/kubernetes.repo</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</pre></td></tr><tr><td data-num="10"></td><td><pre>EOF</pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># yum install -y kubectl kubelet kubeadm</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable kubelet  # 开机启动</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl start kubelet</span></pre></td></tr><tr><td data-num="15"></td><td><pre> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># echo "1" >/proc/sys/net/bridge/bridge-nf-call-iptables</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm init --pod-network-cidr=10.244.0.0/16  # 2 处理器，内存 > 1700M</span></pre></td></tr></table></figure><h2 id="k8sgcrio问题先通过vps将images-push到docker-hub然后再从docker-hub-pull"><a class="anchor" href="#k8sgcrio问题先通过vps将images-push到docker-hub然后再从docker-hub-pull">#</a> k8s.gcr.io 问题，先通过 vps 将 images push 到 docker hub，然后再从 docker hub pull</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre>k8s问题</pre></td></tr><tr><td data-num="2"></td><td><pre>error execution phase preflight: <span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Some fatal errors occurred:</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/kube-apiserver:v1.21.3: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/kube-controller-manager:v1.21.3: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/kube-scheduler:v1.21.3: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/kube-proxy:v1.21.3: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/pause:3.4.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/etcd:3.4.13-0: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">[</span>ERROR ImagePull<span class="token punctuation">]</span>: failed to pull image k8s.gcr.io/coredns/coredns:v1.8.0: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">(</span>Client.Timeout exceeded <span class="token keyword">while</span> awaiting headers<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>, error: <span class="token builtin class-name">exit</span> status <span class="token number">1</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/kube-apiserver:v1.21.3 chumingcheng/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/kube-controller-manager:v1.21.3</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/kube-controller-manager:v1.21.3 chumingcheng/kube-controller-manager:v1.21.3</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/kube-controller-manager:v1.21.3</span></pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/kube-scheduler:v1.21.3</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/kube-scheduler:v1.21.3 chumingcheng/kube-scheduler:v1.21.3</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/kube-scheduler:v1.21.3</span></pre></td></tr><tr><td data-num="12"></td><td><pre> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/kube-proxy:v1.21.3 chumingcheng/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="16"></td><td><pre> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/pause:3.4.1</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/pause:3.4.1 chumingcheng/pause:3.4.1</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/pause:3.4.1</span></pre></td></tr><tr><td data-num="20"></td><td><pre> </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/etcd:3.4.13-0</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/etcd:3.4.13-0 chumingcheng/etcd:3.4.13-0</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/etcd:3.4.13-0</span></pre></td></tr><tr><td data-num="24"></td><td><pre> </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker pull k8s.gcr.io/coredns/coredns:v1.8.0</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker tag k8s.gcr.io/coredns/coredns:v1.8.0 chumingcheng/coredns/coredns:v1.8.0</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span>root@chumingcheng ~<span class="token punctuation">]</span><span class="token comment"># docker push chumingcheng/coredns/coredns:v1.8.0</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker pull chumingcheng/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker tag chumingcheng/kube-apiserver:v1.21.3 k8s.gcr.io/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker rmi chumingcheng/kube-apiserver:v1.21.3</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker pull chumingcheng/coredns/coredns:v1.8.0</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker tag chumingcheng/coredns/coredns:v1.8.0 k8s.gcr.io/coredns/coredns:v1.8.0</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># docker rmi chumingcheng/coredns/coredns:v1.8.0</span></pre></td></tr></table></figure><h2 id="上面问题解决后执行下面kubeadm-join-xxx这条命令备份后面节点加入需要执行"><a class="anchor" href="#上面问题解决后执行下面kubeadm-join-xxx这条命令备份后面节点加入需要执行">#</a> 上面问题解决后，执行下面，kubeadm join xxx 这条命令备份（后面节点加入需要执行）</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>To start using your cluster, you need to run the following as a regular user:</pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube</pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="10"></td><td><pre> </pre></td></tr><tr><td data-num="11"></td><td><pre>Alternatively, <span class="token keyword">if</span> you are the root user, you can run:</pre></td></tr><tr><td data-num="12"></td><td><pre> </pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf</pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre>You should now deploy a pod network to the cluster.</pre></td></tr><tr><td data-num="16"></td><td><pre>Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:</pre></td></tr><tr><td data-num="17"></td><td><pre>  https://kubernetes.io/docs/concepts/cluster-administration/addons/</pre></td></tr><tr><td data-num="18"></td><td><pre> </pre></td></tr><tr><td data-num="19"></td><td><pre>Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:</pre></td></tr><tr><td data-num="20"></td><td><pre> </pre></td></tr><tr><td data-num="21"></td><td><pre>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.2.170:6443 <span class="token parameter variable">--token</span> c9xhek.j1lztmtz06fh7yy7 --discovery-token-ca-cert-hash sha256:e939c045bc5f49e4b7c39b0103f8e704b5f6cb0bbef7677b2f69db9d68cb6de6</pre></td></tr><tr><td data-num="22"></td><td><pre> </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p $HOME/.kube</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sysctl net.bridge.bridge-nf-call-iptables=1</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># curl -O https://raw.githubusercontent.com/coreos/flannel/v0.10.0/Documentation/kube-flannel.yml  # 这里可能拿不到，我直接从 github 搜了个直接用了，https://github.com/mrlxxx/kube-flannel.yml/edit/master/kube-flannel.yml</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f kube-flannel.yml </span></pre></td></tr><tr><td data-num="29"></td><td><pre>Warning: policy/v1beta1 PodSecurityPolicy is deprecated <span class="token keyword">in</span> v1.21+, unavailable <span class="token keyword">in</span> v1.25+</pre></td></tr><tr><td data-num="30"></td><td><pre>podsecuritypolicy.policy/psp.flannel.unprivileged created</pre></td></tr><tr><td data-num="31"></td><td><pre>Warning: rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated <span class="token keyword">in</span> v1.17+, unavailable <span class="token keyword">in</span> v1.22+<span class="token punctuation">;</span> use rbac.authorization.k8s.io/v1 ClusterRole</pre></td></tr><tr><td data-num="32"></td><td><pre>clusterrole.rbac.authorization.k8s.io/flannel configured</pre></td></tr><tr><td data-num="33"></td><td><pre>Warning: rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated <span class="token keyword">in</span> v1.17+, unavailable <span class="token keyword">in</span> v1.22+<span class="token punctuation">;</span> use rbac.authorization.k8s.io/v1 ClusterRoleBinding</pre></td></tr><tr><td data-num="34"></td><td><pre>clusterrolebinding.rbac.authorization.k8s.io/flannel unchanged</pre></td></tr><tr><td data-num="35"></td><td><pre>serviceaccount/flannel unchanged</pre></td></tr><tr><td data-num="36"></td><td><pre>configmap/kube-flannel-cfg configured</pre></td></tr><tr><td data-num="37"></td><td><pre>daemonset.apps/kube-flannel-ds-amd64 created</pre></td></tr><tr><td data-num="38"></td><td><pre>daemonset.apps/kube-flannel-ds-arm64 created</pre></td></tr><tr><td data-num="39"></td><td><pre>daemonset.apps/kube-flannel-ds-arm created</pre></td></tr><tr><td data-num="40"></td><td><pre>daemonset.apps/kube-flannel-ds-ppc64le created</pre></td></tr><tr><td data-num="41"></td><td><pre>daemonset.apps/kube-flannel-ds-s390x created</pre></td></tr></table></figure><h2 id="上面master部署结束现在去配置节点另一条非master虚拟机执行-报error"><a class="anchor" href="#上面master部署结束现在去配置节点另一条非master虚拟机执行-报error">#</a> 上面 master 部署结束，现在去配置节点（另一条非 master 虚拟机）执行，报 error</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># swapoff -a</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># echo "1" >/proc/sys/net/bridge/bridge-nf-call-iptables</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@slave ~<span class="token punctuation">]</span><span class="token comment"># kubeadm join 192.168.2.170:6443 --token c9xhek.j1lztmtz06fh7yy7 --discovery-token-ca-cert-hash sha256:e939c045bc5f49e4b7c39b0103f8e704b5f6cb0bbef7677b2f69db9d68cb6de6</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="token string">"systemd"</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/</pre></td></tr><tr><td data-num="6"></td><td><pre>error execution phase preflight: couldn't validate the identity of the API Server: Get <span class="token string">"https://192.168.2.170:6443/api/v1/namespaces/kube-public/configmaps/cluster-info?timeout=10s"</span><span class="token builtin class-name">:</span> dial tcp <span class="token number">192.168</span>.2.170:6443: connect: no route to <span class="token function">host</span></pre></td></tr><tr><td data-num="7"></td><td><pre>To see the stack trace of this error execute with <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">5</span> or higher</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@slave ~<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>上面的原因是因为使用 vmware 安装虚拟机后默认打开了防火墙，执行以下命令即可</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre>-----------------------------------------------------------------</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># iptables --flush</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># iptables -tnat --flush</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</pre></td></tr><tr><td data-num="7"></td><td><pre>Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># kubeadm join 192.168.2.170:6443 --token bgsrcq.d5sqfplppncii6sp \</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">></span> --discovery-token-ca-cert-hash sha256:7bf637f77ff1e56fa137e0ca1433db22e44fed5e0057b910a8abc4b110b3ec0a</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks</pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="token string">"systemd"</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">'kubectl -n kube-system get cm kubeadm-config -o yaml'</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/config.yaml"</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/kubeadm-flags.env"</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to perform the TLS Bootstrap<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="19"></td><td><pre> </pre></td></tr><tr><td data-num="20"></td><td><pre>This <span class="token function">node</span> has joined the cluster:</pre></td></tr><tr><td data-num="21"></td><td><pre>* Certificate signing request was sent to apiserver and a response was received.</pre></td></tr><tr><td data-num="22"></td><td><pre>* The Kubelet was informed of the new secure connection details.</pre></td></tr><tr><td data-num="23"></td><td><pre> </pre></td></tr><tr><td data-num="24"></td><td><pre>Run <span class="token string">'kubectl get nodes'</span> on the control-plane to see this <span class="token function">node</span> <span class="token function">join</span> the cluster.</pre></td></tr><tr><td data-num="25"></td><td><pre> </pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># </span></pre></td></tr><tr><td data-num="27"></td><td><pre> </pre></td></tr><tr><td data-num="28"></td><td><pre>----------------------------------------------------------------------</pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># iptables --flush</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># iptables -tnat --flush</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n kube-system -o wide</span></pre></td></tr><tr><td data-num="35"></td><td><pre>NAME                             READY   STATUS              RESTARTS   AGE   IP              NODE     NOMINATED NODE   READINESS GATES</pre></td></tr><tr><td data-num="36"></td><td><pre>coredns-558bd4d5db-6l2jf         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          18m   <span class="token number">10.244</span>.0.6      master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="37"></td><td><pre>coredns-558bd4d5db-vkrvp         <span class="token number">1</span>/1     Running             <span class="token number">1</span>          18m   <span class="token number">10.244</span>.0.5      master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="38"></td><td><pre>etcd-master                      <span class="token number">1</span>/1     Running             <span class="token number">1</span>          18m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="39"></td><td><pre>kube-apiserver-master            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          18m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="40"></td><td><pre>kube-controller-manager-master   <span class="token number">1</span>/1     Running             <span class="token number">1</span>          18m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="41"></td><td><pre>kube-flannel-ds-amd64-7jq99      <span class="token number">0</span>/1     Init:0/1            <span class="token number">0</span>          70s   <span class="token number">192.168</span>.2.174   <span class="token function">node</span>     <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="42"></td><td><pre>kube-flannel-ds-amd64-vzrlt      <span class="token number">1</span>/1     Running             <span class="token number">2</span>          13m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="43"></td><td><pre>kube-proxy-fmrwp                 <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          70s   <span class="token number">192.168</span>.2.174   <span class="token function">node</span>     <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="44"></td><td><pre>kube-proxy-m7mr4                 <span class="token number">1</span>/1     Running             <span class="token number">2</span>          18m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="45"></td><td><pre>kube-scheduler-master            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          18m   <span class="token number">192.168</span>.2.170   master   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span></pre></td></tr><tr><td data-num="47"></td><td><pre>NAME     STATUS     ROLES                  AGE    VERSION</pre></td></tr><tr><td data-num="48"></td><td><pre>master   Ready      control-plane,master   22m    v1.21.3</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token function">node</span>     NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>                 5m9s   v1.21.3</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h2 id="重新init-master即断开和node的连接这样node可以重新join"><a class="anchor" href="#重新init-master即断开和node的连接这样node可以重新join">#</a> 重新 init master，即断开和 node 的连接，这样 node 可以重新 join</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo kubeadm reset</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ps -efl|grep kube</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">..</span>. <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="5"></td><td><pre>Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>To start using your cluster, you need to run the following as a regular user:</pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config</pre></td></tr><tr><td data-num="12"></td><td><pre> </pre></td></tr><tr><td data-num="13"></td><td><pre>Alternatively, <span class="token keyword">if</span> you are the root user, you can run:</pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/kubernetes/admin.conf</pre></td></tr><tr><td data-num="16"></td><td><pre> </pre></td></tr><tr><td data-num="17"></td><td><pre>You should now deploy a pod network to the cluster.</pre></td></tr><tr><td data-num="18"></td><td><pre>Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:</pre></td></tr><tr><td data-num="19"></td><td><pre>  https://kubernetes.io/docs/concepts/cluster-administration/addons/</pre></td></tr><tr><td data-num="20"></td><td><pre> </pre></td></tr><tr><td data-num="21"></td><td><pre>Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:</pre></td></tr><tr><td data-num="22"></td><td><pre> </pre></td></tr><tr><td data-num="23"></td><td><pre>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.2.170:6443 <span class="token parameter variable">--token</span> bgsrcq.d5sqfplppncii6sp <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	--discovery-token-ca-cert-hash sha256:7bf637f77ff1e56fa137e0ca1433db22e44fed5e0057b910a8abc4b110b3ec0a</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p $HOME/.kube</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></pre></td></tr><tr><td data-num="27"></td><td><pre>cp: overwrite ‘/root/.kube/config’? y</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo sysctl net.bridge.bridge-nf-call-iptables=1</span></pre></td></tr><tr><td data-num="30"></td><td><pre>net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># sudo kubectl apply -f kube-flannel.yml</span></pre></td></tr></table></figure><h2 id="浏览器访问https19216821706443报403forbidden-user-systemanonymous-cannot-get-path-并且status是failure-参考httpsblogcsdnnetbaidu_38432732articledetails106469037"><a class="anchor" href="#浏览器访问https19216821706443报403forbidden-user-systemanonymous-cannot-get-path-并且status是failure-参考httpsblogcsdnnetbaidu_38432732articledetails106469037">#</a> 浏览器访问 https://192.168.2.170:6443 / 报 403：forbidden: User &quot;system:anonymous&quot; cannot get path &quot;/&quot; 并且 status 是 Failure。（参考：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JhaWR1XzM4NDMyNzMyL2FydGljbGUvZGV0YWlscy8xMDY0NjkwMzclRUYlQkMlODk=">https://blog.csdn.net/baidu_38432732/article/details/106469037）</span></h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># grep 'client-certificate-data' ~/.kube/config | head -n 1 | awk '&#123;print $2&#125;' | base64 -d >> kubecfg.crt</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># grep 'client-key-data' ~/.kube/config | head -n 1 | awk '&#123;print $2&#125;' | base64 -d >> kubecfg.key</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># openssl pkcs12 -export -clcerts -inkey kubecfg.key -in kubecfg.crt -out kubecfg.p12 -name "kubernetes-client"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Enter Export Password:</pre></td></tr><tr><td data-num="5"></td><td><pre>Verifying - Enter Export Password:</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="7"></td><td><pre>demo-master  demo-master.zip  kubecfg.crt  kubecfg.key  kubecfg.p12  kube-flannel1.yml  kube-flannel2.yml  kube-flannel.yml</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><p>浏览器导入上面 p12 证书，重启浏览器，访问该地址，可以看到返回 api 所有的 path。</p><p><img data-src="../../../../images/k8s01.png" alt="k8s01"></p><h2 id="使用kubectl-get-pods发现node上2个pod一个一直处于init状态另一个一直处于containercreating状态查看具体信息发现pull镜像k8sgcriopause341一直pull不下来手动去node上pull下最好把proxy镜像也顺便一块pull下如果是其他版本镜像最好从docker-hub找找可以按日期查找找最新的pull过镜像后可以去master上手动删除这俩pod然后k8s会自动重新初始化这俩pod"><a class="anchor" href="#使用kubectl-get-pods发现node上2个pod一个一直处于init状态另一个一直处于containercreating状态查看具体信息发现pull镜像k8sgcriopause341一直pull不下来手动去node上pull下最好把proxy镜像也顺便一块pull下如果是其他版本镜像最好从docker-hub找找可以按日期查找找最新的pull过镜像后可以去master上手动删除这俩pod然后k8s会自动重新初始化这俩pod">#</a> 使用 kubectl get pods 发现 node 上 2 个 pod 一个一直处于 init 状态，另一个一直处于 ContainerCreating 状态，<span class="exturl" data-url="aHR0cDovL3huLS1wdWxsazhzLW0xNWtoNWJlNmR2OWJxMG15MzliNTJ2OW40YnNobDZ0OWouZ2NyLmlvL3BhdXNlOjMuNC4xJUU0JUI4JTgwJUU3JTlCJUI0cHVsbCVFNCVCOCU4RCVFNCVCOCU4QiVFNiU5RCVBNSVFRiVCQyU4QyVFNiU4OSU4QiVFNSU4QSVBOCVFNSU4RSVCQm5vZGUlRTQlQjglOEFwdWxsJUU0JUI4JThCJUVGJUJDJThDJUU2JTlDJTgwJUU1JUE1JUJEJUU2JThBJThBcHJveHklRTklOTUlOUMlRTUlODMlOEYlRTQlQjklOUYlRTklQTElQkElRTQlQkUlQkYlRTQlQjglODAlRTUlOUQlOTdwdWxsJUU0JUI4JThCJUVGJUJDJThDJUU1JUE2JTgyJUU2JTlFJTlDJUU2JTk4JUFGJUU1JTg1JUI2JUU0JUJCJTk2JUU3JTg5JTg4JUU2JTlDJUFDJUU5JTk1JTlDJUU1JTgzJThGJUVGJUJDJThDJUU2JTlDJTgwJUU1JUE1JUJEJUU0JUJCJThFZG9ja2Vy">查看具体信息发现 pull 镜像 k8s.gcr.io/pause:3.4.1 一直 pull 不下来，手动去 node 上 pull 下，最好把 proxy 镜像也顺便一块 pull 下，如果是其他版本镜像，最好从 docker</span> hub 找找，可以按日期查找找最新的，pull 过镜像后可以去 master 上手动删除这俩 pod，然后 k8s 会自动重新初始化这俩 pod。</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre>------------------------------master---------------------------------------</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get po --all-namespaces</span></pre></td></tr><tr><td data-num="3"></td><td><pre>NAMESPACE     NAME                             READY   STATUS              RESTARTS   AGE</pre></td></tr><tr><td data-num="4"></td><td><pre>kube-system   coredns-558bd4d5db-6l2jf         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          46m</pre></td></tr><tr><td data-num="5"></td><td><pre>kube-system   coredns-558bd4d5db-vkrvp         <span class="token number">1</span>/1     Running             <span class="token number">1</span>          46m</pre></td></tr><tr><td data-num="6"></td><td><pre>kube-system   etcd-master                      <span class="token number">1</span>/1     Running             <span class="token number">1</span>          46m</pre></td></tr><tr><td data-num="7"></td><td><pre>kube-system   kube-apiserver-master            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          46m</pre></td></tr><tr><td data-num="8"></td><td><pre>kube-system   kube-controller-manager-master   <span class="token number">1</span>/1     Running             <span class="token number">1</span>          46m</pre></td></tr><tr><td data-num="9"></td><td><pre>kube-system   kube-flannel-ds-amd64-7jq99      <span class="token number">0</span>/1     Init:0/1            <span class="token number">0</span>          28m</pre></td></tr><tr><td data-num="10"></td><td><pre>kube-system   kube-flannel-ds-amd64-vzrlt      <span class="token number">1</span>/1     Running             <span class="token number">2</span>          40m</pre></td></tr><tr><td data-num="11"></td><td><pre>kube-system   kube-proxy-fmrwp                 <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          28m</pre></td></tr><tr><td data-num="12"></td><td><pre>kube-system   kube-proxy-m7mr4                 <span class="token number">1</span>/1     Running             <span class="token number">2</span>          46m</pre></td></tr><tr><td data-num="13"></td><td><pre>kube-system   kube-scheduler-master            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          46m</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl describe pod kube-flannel-ds-amd64-7jq99 -n kube-system</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span>. <span class="token punctuation">..</span>. get https://k8s.gcr.io/v2/: net/http: request canceled <span class="token keyword">while</span> waiting <span class="token keyword">for</span> connection <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="16"></td><td><pre> </pre></td></tr><tr><td data-num="17"></td><td><pre>-------------------------------node---------------------------------------</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker pull chumingcheng/pause:3.4.1</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">3.4</span>.1: Pulling from chumingcheng/pause</pre></td></tr><tr><td data-num="20"></td><td><pre>fac425775c9d: Pull complete </pre></td></tr><tr><td data-num="21"></td><td><pre>Digest: sha256:9ec1e780f5c0196af7b28f135ffc0533eddcb0a54a0ba8b32943303ce76fe70d</pre></td></tr><tr><td data-num="22"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> chumingcheng/pause:3.4.1</pre></td></tr><tr><td data-num="23"></td><td><pre>docker.io/chumingcheng/pause:3.4.1</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker tag chumingcheng/pause:3.4.1 k8s.gcr.io/pause:3.4.1</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker rmi chumingcheng/pause:3.4.1</span></pre></td></tr><tr><td data-num="26"></td><td><pre>Untagged: chumingcheng/pause:3.4.1</pre></td></tr><tr><td data-num="27"></td><td><pre>Untagged: chumingcheng/pause@sha256:9ec1e780f5c0196af7b28f135ffc0533eddcb0a54a0ba8b32943303ce76fe70d</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="29"></td><td><pre>REPOSITORY               TAG             IMAGE ID       CREATED        SIZE</pre></td></tr><tr><td data-num="30"></td><td><pre>hello-world              latest          d1165f221234   <span class="token number">4</span> months ago   <span class="token number">13</span>.3kB</pre></td></tr><tr><td data-num="31"></td><td><pre>k8s.gcr.io/pause         <span class="token number">3.4</span>.1           0f8457a4c2ec   <span class="token number">6</span> months ago   683kB</pre></td></tr><tr><td data-num="32"></td><td><pre>quay.io/coreos/flannel   v0.11.0-amd64   ff281650a721   <span class="token number">2</span> years ago    <span class="token number">52</span>.6MB</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker pull chumingcheng/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="34"></td><td><pre>v1.21.3: Pulling from chumingcheng/kube-proxy</pre></td></tr><tr><td data-num="35"></td><td><pre>fe5d561940df: Pull complete </pre></td></tr><tr><td data-num="36"></td><td><pre>76d59146d9bf: Pull complete </pre></td></tr><tr><td data-num="37"></td><td><pre>Digest: sha256:af5c9bacb913b5751d2d94e11dfd4e183e97b1a4afce282be95ce177f4a0100b</pre></td></tr><tr><td data-num="38"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> chumingcheng/kube-proxy:v1.21.3</pre></td></tr><tr><td data-num="39"></td><td><pre>docker.io/chumingcheng/kube-proxy:v1.21.3</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker tag chumingcheng/kube-proxy:v1.21.3 k8s.gcr.io/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker rmi chumingcheng/kube-proxy:v1.21.3</span></pre></td></tr><tr><td data-num="42"></td><td><pre>Untagged: chumingcheng/kube-proxy:v1.21.3</pre></td></tr><tr><td data-num="43"></td><td><pre>Untagged: chumingcheng/kube-proxy@sha256:af5c9bacb913b5751d2d94e11dfd4e183e97b1a4afce282be95ce177f4a0100b</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="45"></td><td><pre>REPOSITORY               TAG             IMAGE ID       CREATED        SIZE</pre></td></tr><tr><td data-num="46"></td><td><pre>k8s.gcr.io/kube-proxy    v1.21.3         adb2816ea823   <span class="token number">2</span> weeks ago    103MB</pre></td></tr><tr><td data-num="47"></td><td><pre>hello-world              latest          d1165f221234   <span class="token number">4</span> months ago   <span class="token number">13</span>.3kB</pre></td></tr><tr><td data-num="48"></td><td><pre>k8s.gcr.io/pause         <span class="token number">3.4</span>.1           0f8457a4c2ec   <span class="token number">6</span> months ago   683kB</pre></td></tr><tr><td data-num="49"></td><td><pre>quay.io/coreos/flannel   v0.11.0-amd64   ff281650a721   <span class="token number">2</span> years ago    <span class="token number">52</span>.6MB</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">[</span>root@node ~<span class="token punctuation">]</span><span class="token comment"># </span></pre></td></tr><tr><td data-num="51"></td><td><pre> </pre></td></tr><tr><td data-num="52"></td><td><pre>--------------------------------master------------------------------------------</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl delete pod kube-flannel-ds-amd64-7jq99 -n kube-system</span></pre></td></tr><tr><td data-num="54"></td><td><pre>pod <span class="token string">"kube-flannel-ds-amd64-7jq99"</span> deleted</pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl delete pod kube-proxy-fmrwp -n kube-system</span></pre></td></tr><tr><td data-num="56"></td><td><pre>pod <span class="token string">"kube-proxy-fmrwp"</span> deleted</pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get po --all-namespaces</span></pre></td></tr><tr><td data-num="58"></td><td><pre>NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="59"></td><td><pre>kube-system   coredns-558bd4d5db-6l2jf         <span class="token number">1</span>/1     Running   <span class="token number">2</span>          70m</pre></td></tr><tr><td data-num="60"></td><td><pre>kube-system   coredns-558bd4d5db-vkrvp         <span class="token number">1</span>/1     Running   <span class="token number">1</span>          70m</pre></td></tr><tr><td data-num="61"></td><td><pre>kube-system   etcd-master                      <span class="token number">1</span>/1     Running   <span class="token number">1</span>          70m</pre></td></tr><tr><td data-num="62"></td><td><pre>kube-system   kube-apiserver-master            <span class="token number">1</span>/1     Running   <span class="token number">1</span>          70m</pre></td></tr><tr><td data-num="63"></td><td><pre>kube-system   kube-controller-manager-master   <span class="token number">1</span>/1     Running   <span class="token number">1</span>          70m</pre></td></tr><tr><td data-num="64"></td><td><pre>kube-system   kube-flannel-ds-amd64-vzrlt      <span class="token number">1</span>/1     Running   <span class="token number">2</span>          64m</pre></td></tr><tr><td data-num="65"></td><td><pre>kube-system   kube-flannel-ds-amd64-z7bs4      <span class="token number">1</span>/1     Running   <span class="token number">6</span>          5m41s</pre></td></tr><tr><td data-num="66"></td><td><pre>kube-system   kube-proxy-fx2g6                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5m21s</pre></td></tr><tr><td data-num="67"></td><td><pre>kube-system   kube-proxy-m7mr4                 <span class="token number">1</span>/1     Running   <span class="token number">2</span>          70m</pre></td></tr><tr><td data-num="68"></td><td><pre>kube-system   kube-scheduler-master            <span class="token number">1</span>/1     Running   <span class="token number">1</span>          70m</pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h2 id="创建deployments时候报error-unable-to-recognize-deploymentyaml-no-matches-for-kind-deployment-in-version-extensionsv1beta1"><a class="anchor" href="#创建deployments时候报error-unable-to-recognize-deploymentyaml-no-matches-for-kind-deployment-in-version-extensionsv1beta1">#</a> 创建 deployments 时候报 error: unable to recognize &quot;deployment.yaml&quot;: no matches for kind &quot;Deployment&quot; in version &quot;extensions/v1beta1&quot;</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml </span></pre></td></tr><tr><td data-num="2"></td><td><pre>---</pre></td></tr><tr><td data-num="3"></td><td><pre>apiVersion: extensions/v1beta1</pre></td></tr><tr><td data-num="4"></td><td><pre>kind: Deployment</pre></td></tr><tr><td data-num="5"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="6"></td><td><pre>  name: kube-node</pre></td></tr><tr><td data-num="7"></td><td><pre>spec:</pre></td></tr><tr><td data-num="8"></td><td><pre>  replicas: <span class="token number">2</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  template:</pre></td></tr><tr><td data-num="10"></td><td><pre>    metadata:</pre></td></tr><tr><td data-num="11"></td><td><pre>      labels:</pre></td></tr><tr><td data-num="12"></td><td><pre>        app: web</pre></td></tr><tr><td data-num="13"></td><td><pre>    spec:</pre></td></tr><tr><td data-num="14"></td><td><pre>      containers:</pre></td></tr><tr><td data-num="15"></td><td><pre>        - name: kube-node-demo-instance</pre></td></tr><tr><td data-num="16"></td><td><pre>          image: chumingcheng/myhello</pre></td></tr><tr><td data-num="17"></td><td><pre>          ports:</pre></td></tr><tr><td data-num="18"></td><td><pre>            - containerPort: <span class="token number">8888</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl api-resources | grep deployment</span></pre></td></tr><tr><td data-num="20"></td><td><pre>deployments                       deploy       apps/v1                                <span class="token boolean">true</span>         Deployment</pre></td></tr></table></figure><p>将上面 apiVersion 改为 apps/v1 即可。</p><h2 id="创建deployment以一个简单的nodejs-server项目为例参考httpsblogcsdnnetwucong60articledetails81586272"><a class="anchor" href="#创建deployment以一个简单的nodejs-server项目为例参考httpsblogcsdnnetwucong60articledetails81586272">#</a> 创建 deployment，以一个简单的 nodejs server 项目为例（参考：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3d1Y29uZzYwL2FydGljbGUvZGV0YWlscy84MTU4NjI3MiVFRiVCQyU4OQ==">https://blog.csdn.net/wucong60/article/details/81586272）</span></h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl -sL https://rpm.nodesource.com/setup_14.x | sudo bash -</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># sudo yum install -y nodejs</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># mkdir kube-demo</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cd kube-demo</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># touch server.js</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># vi server.js  # 复制下面内容</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># cat server.js</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># cat server.js</span></pre></td></tr><tr><td data-num="9"></td><td><pre>var http <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> </pre></td></tr><tr><td data-num="11"></td><td><pre>var handleRequest <span class="token operator">=</span> function<span class="token punctuation">(</span>request, response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  console.log<span class="token punctuation">(</span><span class="token string">'Received request for URL: '</span> + request.url<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  response.writeHead<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  response.end<span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>var www <span class="token operator">=</span> http.createServer<span class="token punctuation">(</span>handleRequest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>www.listen<span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># node server.js  # 启动测试下，浏览器访问 8081 测试</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># touch Dockerfile</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># docker image build -t kube-demo .</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># vi Dockerfile  #  复制下面内容</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span></pre></td></tr><tr><td data-num="23"></td><td><pre>FROM node:8.11.2</pre></td></tr><tr><td data-num="24"></td><td><pre>WORKDIR app</pre></td></tr><tr><td data-num="25"></td><td><pre>COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="26"></td><td><pre>EXPOSE <span class="token number">8081</span></pre></td></tr><tr><td data-num="27"></td><td><pre>ENTRYPOINT <span class="token punctuation">[</span> <span class="token string">"node"</span>,<span class="token string">"server.js"</span> <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># docker tag kube-demo chumingcheng/kube-demo</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@master kube-demo<span class="token punctuation">]</span><span class="token comment"># docker image push chumingcheng/kube-demo</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># vi deployment.yaml   # 复制下面内容</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># cat deployment.yaml </span></pre></td></tr><tr><td data-num="32"></td><td><pre>---</pre></td></tr><tr><td data-num="33"></td><td><pre>apiVersion: apps/v1</pre></td></tr><tr><td data-num="34"></td><td><pre>kind: Deployment</pre></td></tr><tr><td data-num="35"></td><td><pre>metadata:</pre></td></tr><tr><td data-num="36"></td><td><pre>  name: kube-node</pre></td></tr><tr><td data-num="37"></td><td><pre>spec:</pre></td></tr><tr><td data-num="38"></td><td><pre>  selector:</pre></td></tr><tr><td data-num="39"></td><td><pre>    matchLabels:</pre></td></tr><tr><td data-num="40"></td><td><pre>      app: web</pre></td></tr><tr><td data-num="41"></td><td><pre>  replicas: <span class="token number">2</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  template:</pre></td></tr><tr><td data-num="43"></td><td><pre>    metadata:</pre></td></tr><tr><td data-num="44"></td><td><pre>      labels:</pre></td></tr><tr><td data-num="45"></td><td><pre>        app: web</pre></td></tr><tr><td data-num="46"></td><td><pre>    spec:</pre></td></tr><tr><td data-num="47"></td><td><pre>      containers:</pre></td></tr><tr><td data-num="48"></td><td><pre>        - name: kube-node-demo-instance</pre></td></tr><tr><td data-num="49"></td><td><pre>          image: chumingcheng/kube-demo</pre></td></tr><tr><td data-num="50"></td><td><pre>          ports:</pre></td></tr><tr><td data-num="51"></td><td><pre>            - containerPort: <span class="token number">8081</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl create -f deployment.yaml</span></pre></td></tr><tr><td data-num="53"></td><td><pre>deployment.apps/kube-node created</pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span></pre></td></tr><tr><td data-num="55"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="56"></td><td><pre>kube-node-6fb65f5d5b-c7966   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m3s</pre></td></tr><tr><td data-num="57"></td><td><pre>kube-node-6fb65f5d5b-w5qb9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m3s</pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span></pre></td></tr><tr><td data-num="59"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE     IP           NODE   NOMINATED NODE   READINESS GATES</pre></td></tr><tr><td data-num="60"></td><td><pre>kube-node-6fb65f5d5b-c7966   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m36s   <span class="token number">10.244</span>.1.2   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="61"></td><td><pre>kube-node-6fb65f5d5b-w5qb9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m36s   <span class="token number">10.244</span>.1.3   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># curl 10.244.1.2:8081</span></pre></td></tr><tr><td data-num="63"></td><td><pre>Hello World<span class="token operator">!</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># curl 10.244.1.3:8081</span></pre></td></tr><tr><td data-num="65"></td><td><pre>Hello World<span class="token operator">!</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h2 id="修改和删除deployments查看podservices"><a class="anchor" href="#修改和删除deployments查看podservices">#</a> 修改和删除 deployments，查看 pod，services</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span></pre></td></tr><tr><td data-num="2"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE   IP           NODE   NOMINATED NODE   READINESS GATES</pre></td></tr><tr><td data-num="3"></td><td><pre>kube-node-6fb65f5d5b-c7966   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token number">10.244</span>.1.2   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>kube-node-6fb65f5d5b-w5qb9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token number">10.244</span>.1.3   <span class="token function">node</span>   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span></pre></td></tr><tr><td data-num="6"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="7"></td><td><pre>kube-node-6fb65f5d5b-c7966   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11m</pre></td></tr><tr><td data-num="8"></td><td><pre>kube-node-6fb65f5d5b-w5qb9   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11m</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deployments --all-namespaces</span></pre></td></tr><tr><td data-num="10"></td><td><pre>NAMESPACE     NAME        READY   UP-TO-DATE   AVAILABLE   AGE</pre></td></tr><tr><td data-num="11"></td><td><pre>default       kube-node   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           12m</pre></td></tr><tr><td data-num="12"></td><td><pre>kube-system   coredns     <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           173m</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl delete -f deployment.yaml    # 删除，删除后可重新编辑 deployment.yaml，然后再次创建</span></pre></td></tr><tr><td data-num="14"></td><td><pre>deployment.apps <span class="token string">"kube-node"</span> deleted</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deployments --all-namespaces</span></pre></td></tr><tr><td data-num="16"></td><td><pre>NAMESPACE     NAME      READY   UP-TO-DATE   AVAILABLE   AGE</pre></td></tr><tr><td data-num="17"></td><td><pre>kube-system   coredns   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           174m</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span></pre></td></tr><tr><td data-num="19"></td><td><pre>No resources found <span class="token keyword">in</span> default namespace.</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f deployment.yaml   # 再次创建</span></pre></td></tr><tr><td data-num="21"></td><td><pre>deployment.apps/kube-node created</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get deployments --all-namespaces</span></pre></td></tr><tr><td data-num="23"></td><td><pre>NAMESPACE     NAME        READY   UP-TO-DATE   AVAILABLE   AGE</pre></td></tr><tr><td data-num="24"></td><td><pre>default       kube-node   <span class="token number">1</span>/2     <span class="token number">2</span>            <span class="token number">1</span>           6s</pre></td></tr><tr><td data-num="25"></td><td><pre>kube-system   coredns     <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           175m</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span></pre></td></tr><tr><td data-num="27"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="28"></td><td><pre>kube-node-6fb65f5d5b-2z6lm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          26s</pre></td></tr><tr><td data-num="29"></td><td><pre>kube-node-6fb65f5d5b-p5wr2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          26s</pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl edit deployments/kube-node  # 实时编辑，保存后会自动生效</span></pre></td></tr><tr><td data-num="31"></td><td><pre>Edit cancelled, no changes made.</pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get services --all-namespaces   # 查看 services，在 yaml 里定义</span></pre></td></tr><tr><td data-num="33"></td><td><pre>NAMESPACE     NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                  AGE</pre></td></tr><tr><td data-num="34"></td><td><pre>default       kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP                  3h</pre></td></tr><tr><td data-num="35"></td><td><pre>kube-system   kube-dns     ClusterIP   <span class="token number">10.96</span>.0.10   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">53</span>/UDP,53/TCP,9153/TCP   3h</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span></pre></td></tr><tr><td data-num="37"></td><td><pre>NAME                         READY   STATUS    RESTARTS   AGE</pre></td></tr><tr><td data-num="38"></td><td><pre>kube-node-6fb65f5d5b-2z6lm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8m18s</pre></td></tr><tr><td data-num="39"></td><td><pre>kube-node-6fb65f5d5b-p5wr2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8m18s</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment"># kubectl describe pod kube-node-6fb65f5d5b-2z6lm</span></pre></td></tr><tr><td data-num="41"></td><td><pre>Name:         kube-node-6fb65f5d5b-2z6lm</pre></td></tr><tr><td data-num="42"></td><td><pre>Namespace:    default</pre></td></tr><tr><td data-num="43"></td><td><pre>Priority:     <span class="token number">0</span></pre></td></tr><tr><td data-num="44"></td><td><pre>Node:         node/192.168.2.174</pre></td></tr><tr><td data-num="45"></td><td><pre>Start Time:   Sun, 01 Aug <span class="token number">2021</span> <span class="token number">13</span>:29:04 <span class="token parameter variable">-0700</span></pre></td></tr><tr><td data-num="46"></td><td><pre>Labels:       <span class="token assign-left variable">app</span><span class="token operator">=</span>web</pre></td></tr><tr><td data-num="47"></td><td><pre>              pod-template-hash<span class="token operator">=</span>6fb65f5d5b</pre></td></tr><tr><td data-num="48"></td><td><pre>Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="49"></td><td><pre>Status:       Running</pre></td></tr><tr><td data-num="50"></td><td><pre>IP:           <span class="token number">10.244</span>.1.5</pre></td></tr><tr><td data-num="51"></td><td><pre>IPs:</pre></td></tr><tr><td data-num="52"></td><td><pre>  IP:           <span class="token number">10.244</span>.1.5</pre></td></tr><tr><td data-num="53"></td><td><pre>Controlled By:  ReplicaSet/kube-node-6fb65f5d5b</pre></td></tr><tr><td data-num="54"></td><td><pre>Containers:</pre></td></tr><tr><td data-num="55"></td><td><pre>  kube-node-demo-instance:</pre></td></tr><tr><td data-num="56"></td><td><pre>    Container ID:   docker://7f7297b7f8b14c76e6563bbf22fe3d4fc7dba6b81f3c02d944058a28576ad4c1</pre></td></tr><tr><td data-num="57"></td><td><pre>    Image:          chumingcheng/kube-demo</pre></td></tr><tr><td data-num="58"></td><td><pre>    Image ID:       docker-pullable://chumingcheng/kube-demo@sha256:3426bbcf3f6aa091c0ce328b2f3e2c364db7966af460573fdb97a8893cc8187c</pre></td></tr><tr><td data-num="59"></td><td><pre>    Port:           <span class="token number">8081</span>/TCP</pre></td></tr><tr><td data-num="60"></td><td><pre>    Host Port:      <span class="token number">0</span>/TCP</pre></td></tr><tr><td data-num="61"></td><td><pre>    State:          Running</pre></td></tr><tr><td data-num="62"></td><td><pre>      Started:      Sun, 01 Aug <span class="token number">2021</span> <span class="token number">13</span>:29:11 <span class="token parameter variable">-0700</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    Ready:          True</pre></td></tr><tr><td data-num="64"></td><td><pre>    Restart Count:  <span class="token number">0</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    Environment:    <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="66"></td><td><pre>    Mounts:</pre></td></tr><tr><td data-num="67"></td><td><pre>      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-698sb <span class="token punctuation">(</span>ro<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>Conditions:</pre></td></tr><tr><td data-num="69"></td><td><pre>  Type              Status</pre></td></tr><tr><td data-num="70"></td><td><pre>  Initialized       True </pre></td></tr><tr><td data-num="71"></td><td><pre>  Ready             True </pre></td></tr><tr><td data-num="72"></td><td><pre>  ContainersReady   True </pre></td></tr><tr><td data-num="73"></td><td><pre>  PodScheduled      True </pre></td></tr><tr><td data-num="74"></td><td><pre>Volumes:</pre></td></tr><tr><td data-num="75"></td><td><pre>  kube-api-access-698sb:</pre></td></tr><tr><td data-num="76"></td><td><pre>    Type:                    Projected <span class="token punctuation">(</span>a volume that contains injected data from multiple sources<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>    TokenExpirationSeconds:  <span class="token number">3607</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    ConfigMapName:           kube-root-ca.crt</pre></td></tr><tr><td data-num="79"></td><td><pre>    ConfigMapOptional:       <span class="token operator">&lt;</span>nil<span class="token operator">></span></pre></td></tr><tr><td data-num="80"></td><td><pre>    DownwardAPI:             <span class="token boolean">true</span></pre></td></tr><tr><td data-num="81"></td><td><pre>QoS Class:                   BestEffort</pre></td></tr><tr><td data-num="82"></td><td><pre>Node-Selectors:              <span class="token operator">&lt;</span>none<span class="token operator">></span></pre></td></tr><tr><td data-num="83"></td><td><pre>Tolerations:                 node.kubernetes.io/not-ready:NoExecute <span class="token assign-left variable">op</span><span class="token operator">=</span>Exists <span class="token keyword">for</span> 300s</pre></td></tr><tr><td data-num="84"></td><td><pre>                             node.kubernetes.io/unreachable:NoExecute <span class="token assign-left variable">op</span><span class="token operator">=</span>Exists <span class="token keyword">for</span> 300s</pre></td></tr><tr><td data-num="85"></td><td><pre>Events:</pre></td></tr><tr><td data-num="86"></td><td><pre>  Type    Reason     Age    From               Message</pre></td></tr><tr><td data-num="87"></td><td><pre>  ----    ------     ----   ----               -------</pre></td></tr><tr><td data-num="88"></td><td><pre>  Normal  Scheduled  8m33s  default-scheduler  Successfully assigned default/kube-node-6fb65f5d5b-2z6lm to <span class="token function">node</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  Normal  Pulling    8m32s  kubelet            Pulling image <span class="token string">"chumingcheng/kube-demo"</span></pre></td></tr><tr><td data-num="90"></td><td><pre>  Normal  Pulled     8m26s  kubelet            Successfully pulled image <span class="token string">"chumingcheng/kube-demo"</span> <span class="token keyword">in</span> <span class="token number">6</span>.371285955s</pre></td></tr><tr><td data-num="91"></td><td><pre>  Normal  Created    8m26s  kubelet            Created container kube-node-demo-instance</pre></td></tr><tr><td data-num="92"></td><td><pre>  Normal  Started    8m26s  kubelet            Started container kube-node-demo-instance</pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token punctuation">[</span>root@master k8s<span class="token punctuation">]</span><span class="token comment">#</span></pre></td></tr></table></figure><h2 id="重启虚拟机后启动kube启动master和node要稍等几分钟才能看到ready"><a class="anchor" href="#重启虚拟机后启动kube启动master和node要稍等几分钟才能看到ready">#</a> 重启虚拟机后启动 kube（启动 master 和 node，要稍等几分钟才能看到 Ready）</h2><figure class="highlight shell"><figcaption data-lang="Bash"><span>script</span></figcaption><table><tr><td data-num="1"></td><td><pre>-----------------------------------------------------------------------</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node conf<span class="token punctuation">]</span><span class="token comment"># swapoff -a</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@node conf<span class="token punctuation">]</span><span class="token comment"># systemctl start kubelet</span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre>-----------------------------------------------------------------------</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># swapoff -a</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># systemctl start kubelet</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span></pre></td></tr><tr><td data-num="9"></td><td><pre>NAME     STATUS   ROLES                  AGE   VERSION</pre></td></tr><tr><td data-num="10"></td><td><pre>master   Ready    control-plane,master   10h   v1.21.3</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">node</span>     Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>                 9h    v1.21.3</pre></td></tr></table></figure><div class="tags"><a href="/tags/linux/" rel="tag"><i class="ic i-tag"></i> linux</a> <a href="/tags/k8s/" rel="tag"><i class="ic i-tag"></i> k8s</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-08-07 01:04:04" itemprop="dateModified" datetime="2024-08-07T01:04:04+08:00">2024-08-07</time> </span><span id="learn/devops/kubernetes/k8s简单了解(集群环境搭建与使用)/" class="item leancloud_visitors" data-flag-title="centos k8s 简单了解 (集群环境搭建与使用)" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/mywechatpay.png" alt="Jalen Chu 微信支付"><p>微信支付</p></div><div><img data-src="/images/myalipay.png" alt="Jalen Chu 支付宝"><p>支付宝</p></div><div><img data-src="/images/mywxgzh.png" alt="Jalen Chu 公众号"><p>公众号</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Jalen Chu <i class="ic i-at"><em>@</em></i>Follow your heart</li><li class="link"><strong>本文链接：</strong> <a href="http://jalen.site/learn/devops/kubernetes/k8s%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3(%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8)/" title="centos k8s 简单了解 (集群环境搭建与使用)">http://jalen.site/learn/devops/kubernetes/k8s简单了解(集群环境搭建与使用)/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learn/devops/docker/centos-docker%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;01&#x2F;05&#x2F;c2Af7rxKodnCkbt.jpg" title="centos docker简单操作"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Docker</span><h3>centos docker简单操作</h3></a></div><div class="item right"><a href="/learn/devops/centos/centos7-6%E5%AE%89%E8%A3%85jenkins/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;01&#x2F;05&#x2F;ge1GuDaMQs5mUSC.jpg" title="centos7.6安装jenkins"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> CentOS</span><h3>centos7.6安装jenkins</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#centos-k8s%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">centos k8s 简单了解 (集群环境搭建与使用)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubeadm-kubeletkubectl"><span class="toc-number">1.1.</span> <span class="toc-text">安装 kubeadm， kubelet，kubectl</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8sgcrio%E9%97%AE%E9%A2%98%E5%85%88%E9%80%9A%E8%BF%87vps%E5%B0%86images-push%E5%88%B0docker-hub%E7%84%B6%E5%90%8E%E5%86%8D%E4%BB%8Edocker-hub-pull"><span class="toc-number">1.2.</span> <span class="toc-text">k8s.gcr.io 问题，先通过 vps 将 images push 到 docker hub，然后再从 docker hub pull</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E5%90%8E%E6%89%A7%E8%A1%8C%E4%B8%8B%E9%9D%A2kubeadm-join-xxx%E8%BF%99%E6%9D%A1%E5%91%BD%E4%BB%A4%E5%A4%87%E4%BB%BD%E5%90%8E%E9%9D%A2%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.3.</span> <span class="toc-text">上面问题解决后，执行下面，kubeadm join xxx 这条命令备份（后面节点加入需要执行）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2master%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9D%9F%E7%8E%B0%E5%9C%A8%E5%8E%BB%E9%85%8D%E7%BD%AE%E8%8A%82%E7%82%B9%E5%8F%A6%E4%B8%80%E6%9D%A1%E9%9D%9Emaster%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%89%A7%E8%A1%8C-%E6%8A%A5error"><span class="toc-number">1.4.</span> <span class="toc-text">上面 master 部署结束，现在去配置节点（另一条非 master 虚拟机）执行，报 error</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%96%B0init-master%E5%8D%B3%E6%96%AD%E5%BC%80%E5%92%8Cnode%E7%9A%84%E8%BF%9E%E6%8E%A5%E8%BF%99%E6%A0%B7node%E5%8F%AF%E4%BB%A5%E9%87%8D%E6%96%B0join"><span class="toc-number">1.5.</span> <span class="toc-text">重新 init master，即断开和 node 的连接，这样 node 可以重新 join</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhttps19216821706443%E6%8A%A5403forbidden-user-systemanonymous-cannot-get-path-%E5%B9%B6%E4%B8%94status%E6%98%AFfailure-%E5%8F%82%E8%80%83httpsblogcsdnnetbaidu_38432732articledetails106469037"><span class="toc-number">1.6.</span> <span class="toc-text">浏览器访问 https:&#x2F;&#x2F;192.168.2.170:6443 &#x2F; 报 403：forbidden: User &quot;system:anonymous&quot; cannot get path &quot;&#x2F;&quot; 并且 status 是 Failure。（参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;baidu_38432732&#x2F;article&#x2F;details&#x2F;106469037）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8kubectl-get-pods%E5%8F%91%E7%8E%B0node%E4%B8%8A2%E4%B8%AApod%E4%B8%80%E4%B8%AA%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Einit%E7%8A%B6%E6%80%81%E5%8F%A6%E4%B8%80%E4%B8%AA%E4%B8%80%E7%9B%B4%E5%A4%84%E4%BA%8Econtainercreating%E7%8A%B6%E6%80%81%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E4%BF%A1%E6%81%AF%E5%8F%91%E7%8E%B0pull%E9%95%9C%E5%83%8Fk8sgcriopause341%E4%B8%80%E7%9B%B4pull%E4%B8%8D%E4%B8%8B%E6%9D%A5%E6%89%8B%E5%8A%A8%E5%8E%BBnode%E4%B8%8Apull%E4%B8%8B%E6%9C%80%E5%A5%BD%E6%8A%8Aproxy%E9%95%9C%E5%83%8F%E4%B9%9F%E9%A1%BA%E4%BE%BF%E4%B8%80%E5%9D%97pull%E4%B8%8B%E5%A6%82%E6%9E%9C%E6%98%AF%E5%85%B6%E4%BB%96%E7%89%88%E6%9C%AC%E9%95%9C%E5%83%8F%E6%9C%80%E5%A5%BD%E4%BB%8Edocker-hub%E6%89%BE%E6%89%BE%E5%8F%AF%E4%BB%A5%E6%8C%89%E6%97%A5%E6%9C%9F%E6%9F%A5%E6%89%BE%E6%89%BE%E6%9C%80%E6%96%B0%E7%9A%84pull%E8%BF%87%E9%95%9C%E5%83%8F%E5%90%8E%E5%8F%AF%E4%BB%A5%E5%8E%BBmaster%E4%B8%8A%E6%89%8B%E5%8A%A8%E5%88%A0%E9%99%A4%E8%BF%99%E4%BF%A9pod%E7%84%B6%E5%90%8Ek8s%E4%BC%9A%E8%87%AA%E5%8A%A8%E9%87%8D%E6%96%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%99%E4%BF%A9pod"><span class="toc-number">1.7.</span> <span class="toc-text">使用 kubectl get pods 发现 node 上 2 个 pod 一个一直处于 init 状态，另一个一直处于 ContainerCreating 状态，查看具体信息发现 pull 镜像 k8s.gcr.io&#x2F;pause:3.4.1 一直 pull 不下来，手动去 node 上 pull 下，最好把 proxy 镜像也顺便一块 pull 下，如果是其他版本镜像，最好从 docker hub 找找，可以按日期查找找最新的，pull 过镜像后可以去 master 上手动删除这俩 pod，然后 k8s 会自动重新初始化这俩 pod。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdeployments%E6%97%B6%E5%80%99%E6%8A%A5error-unable-to-recognize-deploymentyaml-no-matches-for-kind-deployment-in-version-extensionsv1beta1"><span class="toc-number">1.8.</span> <span class="toc-text">创建 deployments 时候报 error: unable to recognize &quot;deployment.yaml&quot;: no matches for kind &quot;Deployment&quot; in version &quot;extensions&#x2F;v1beta1&quot;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdeployment%E4%BB%A5%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84nodejs-server%E9%A1%B9%E7%9B%AE%E4%B8%BA%E4%BE%8B%E5%8F%82%E8%80%83httpsblogcsdnnetwucong60articledetails81586272"><span class="toc-number">1.9.</span> <span class="toc-text">创建 deployment，以一个简单的 nodejs server 项目为例（参考：https:&#x2F;&#x2F;blog.csdn.net&#x2F;wucong60&#x2F;article&#x2F;details&#x2F;81586272）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4deployments%E6%9F%A5%E7%9C%8Bpodservices"><span class="toc-number">1.10.</span> <span class="toc-text">修改和删除 deployments，查看 pod，services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%90%AF%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%8E%E5%90%AF%E5%8A%A8kube%E5%90%AF%E5%8A%A8master%E5%92%8Cnode%E8%A6%81%E7%A8%8D%E7%AD%89%E5%87%A0%E5%88%86%E9%92%9F%E6%89%8D%E8%83%BD%E7%9C%8B%E5%88%B0ready"><span class="toc-number">1.11.</span> <span class="toc-text">重启虚拟机后启动 kube（启动 master 和 node，要稍等几分钟才能看到 Ready）</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/learn/devops/kubernetes/k8s%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3(%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8)/" rel="bookmark" title="centos k8s简单了解(集群环境搭建与使用)">centos k8s简单了解(集群环境搭建与使用)</a></li><li><a href="/learn/devops/kubernetes/jenkins+k8s+maven/" rel="bookmark" title="centos registry+jenkins+k8s+maven 简单部署(待续)">centos registry+jenkins+k8s+maven 简单部署(待续)</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Jalen Chu" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Jalen Chu</p><div class="description" itemprop="description">٩(●˙▿˙●)۶…⋆ฺ -></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">700</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">100</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">210</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NpbmNlcmVseVVuaXF1ZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;SincerelyUnique"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9qYWxlbl9jaHU=" title="https:&#x2F;&#x2F;twitter.com&#x2F;jalen_chu"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9qYWxlbmNodQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;jalenchu"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0yMDMxOTczNDY0" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;2031973464"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS9KYWxlbkNodQ==" title="https:&#x2F;&#x2F;about.me&#x2F;JalenChu"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjExNTIzNTc0NzlAcXEuY29t" title="mailto:1152357479@qq.com"><i class="ic i-envelope"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2phbGVuLmNodS43OTIv" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;jalen.chu.792&#x2F;"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xMTExNzYxOC9qYWxlbi1jaHU=" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;11117618&#x2F;jalen-chu"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ3FQRnVtUGpGMWVRdVJrdWp0NUR1YWc=" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCqPFumPjF1eQuRkujt5Duag"><i class="ic i-youtube"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/webstack/" rel="section"><i class="ic i-user"></i>网址</a></li><li class="item dropdown"><a href="/html/%E5%9C%88%E5%B0%8F%E7%8C%AB.html" rel="section"><i class="ic i-tags"></i>玩耍</a><ul class="submenu"><li class="item"><a href="/html/%E5%9C%88%E5%B0%8F%E7%8C%AB.html" rel="section"><i class="ic i-tags"></i>圈小猫</a></li><li class="item"><a href="/html/%E6%92%95%E6%B8%94%E7%BD%91.html" rel="section"><i class="ic i-tags"></i>撕渔网</a></li><li class="item"><a href="/html/%E5%BD%A9%E8%99%B9%E9%9B%A8.html" rel="section"><i class="ic i-tags"></i>彩虹雨</a></li><li class="item"><a href="/html/%E6%96%B9%E5%9D%97%E7%A9%BF%E6%A2%AD.html" rel="section"><i class="ic i-tags"></i>方块穿梭</a></li><li class="item"><a href="/html/%E7%83%9F%E8%8A%B1%E6%95%88%E6%9E%9C.html" rel="section"><i class="ic i-tags"></i>烟花效果</a></li><li class="item"><a href="/html/%E7%A2%B0%E6%92%9E%E5%B0%8F%E7%90%83.html" rel="section"><i class="ic i-tags"></i>碰撞小球</a></li><li class="item"><a href="/html/%E7%BA%B8%E9%A3%9E%E6%9C%BA.html" rel="section"><i class="ic i-tags"></i>纸飞机</a></li><li class="item"><a href="/html/%E9%AA%87%E5%AE%A2%E5%B8%9D%E5%9B%BD.html" rel="section"><i class="ic i-tags"></i>骇客帝国</a></li><li class="item"><a href="/html/%E7%8E%AB%E7%91%B0%E8%8A%B1.html" rel="section"><i class="ic i-tags"></i>玫瑰花</a></li><li class="item"><a href="/html/%E9%97%AE%E9%97%AE%E9%A2%98.html" rel="section"><i class="ic i-tags"></i>问问题</a></li></ul></li><li class="item"><a href="/html/resume/index.html" rel="section"><i class="ic i-th"></i>简历</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learn/devops/docker/centos-docker%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learn/devops/centos/centos7-6%E5%AE%89%E8%A3%85jenkins/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Python-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Python 语言学习">Python 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/python/Pandas/" title="分类于 Pandas">Pandas</a></div><span><a href="/learn/python/pandas/pandas%20excel%E4%B8%8B%E8%BD%BD/" title="pandas excel下载">pandas excel下载</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Java-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Java 语言学习">Java 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/java/Java%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/" title="分类于 Java 开发规范">Java 开发规范</a></div><span><a href="/learn/java/dev-spec/java%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83/" title="java命名规范">java命名规范</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Python-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Python 语言学习">Python 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/python/Flask/" title="分类于 Flask">Flask</a></div><span><a href="/learn/python/flask/flask_excel%E4%B8%8B%E8%BD%BD/" title="flask_excel下载">flask_excel下载</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2147483647%E6%98%AF%E7%B4%A0%E6%95%B0%E8%BF%98%E6%98%AF%E5%90%88%E6%95%B0%EF%BC%9F/" title="2147483647是素数还是合数？">2147483647是素数还是合数？</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Java-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Java 语言学习">Java 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/java/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA/" title="分类于 深入理解 Java 虚拟机">深入理解 Java 虚拟机</a></div><span><a href="/learn/java/deep-understand-jvm/%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E8%87%AA%E5%8A%A8%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6/" title="(2) 自动内存管理机制">(2) 自动内存管理机制</a></span></li><li class="item"><div class="breadcrumb"></div><span><span class="exturl" data-url="aHR0cDovL3d3dy5nb29nbGUuY29tLw==" title="www.google.com">www.google.com<i class="ic i-link-alt"></i></span></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/algorithm/" title="分类于 算法与面试题">算法与面试题</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/algorithm/%E7%AE%97%E6%B3%95%E9%A2%98/" title="分类于 算法题">算法题</a></div><span><a href="/learn/algorithm/practise/%E9%92%A2%E7%AE%A1%E6%8B%BC%E6%8E%A5%E6%9C%80%E4%BC%98%E7%AE%97%E6%B3%95/" title="钢管拼接最低花销">钢管拼接最低花销</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/innerText()%E8%8E%B7%E5%8F%96DOM%E5%80%BC%E5%90%8E%E9%9D%A2%E5%B8%A6%E7%A9%BA%E6%A0%BC%E9%97%AE%E9%A2%98/" title="innerText()获取DOM值后面带空格问题">innerText()获取DOM值后面带空格问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Java-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Java 语言学习">Java 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/java/IntelliJIDEA/" title="分类于 IntelliJIDEA">IntelliJIDEA</a></div><span><a href="/learn/java/idea/idea%E6%97%A0%E6%B3%95%E5%AF%BC%E5%85%A5ojdbc%E9%A9%B1%E5%8A%A8%E4%BE%9D%E8%B5%96/" title="idea无法导入ojdbc驱动依赖">idea无法导入ojdbc驱动依赖</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Java-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Java 语言学习">Java 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/java/Java/" title="分类于 Java">Java</a></div><span><a href="/learn/java/java-basic/java%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6%E6%B5%8B%E8%AF%95%20/" title="java字符串长度测试">java字符串长度测试</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Jalen Chu @ Jalen's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">29:45</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learn/devops/kubernetes/k8s简单了解(集群环境搭建与使用)/",favicon:{show:"（●´3｀●）復活成功",hide:"(´Д｀)瀏覽器崩潰啦"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?908585f2e8b845b564946752e587f4a0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/z16.model.json"},display:{position:"left",width:200,height:400},mobile:{show:!0},react:{opacity:.7}})</script></body></html>