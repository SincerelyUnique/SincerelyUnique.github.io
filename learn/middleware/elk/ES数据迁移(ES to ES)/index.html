<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="MlAWwzcGEsG8nn2V34gojElRFcnHeEgBvIS8Ek1LQ0c"><meta name="msvalidate.01" content="8BDA269F1F25AB9AB2160E377B2334C5"><link rel="alternate" type="application/rss+xml" title="Follow your heart" href="http://jalen.site/rss.xml"><link rel="alternate" type="application/atom+xml" title="Follow your heart" href="http://jalen.site/atom.xml"><link rel="alternate" type="application/json" title="Follow your heart" href="http://jalen.site/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="es"><link rel="canonical" href="http://jalen.site/learn/middleware/elk/ES%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB(ES%20to%20ES)/"><title>ES 数据迁移（ES to ES） - ELK - 中间件学习 - 学习 | Jalen's Blog = Follow your heart = A happy life</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">ES 数据迁移（ES to ES）</h1><div class="meta"><span class="item" title="创建时间：2022-03-16 06:34:43"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-03-16T06:34:43+08:00">2022-03-16</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>3.3k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>3 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jalen's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/01/05/EZ49WJ25iGN61nd.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/mvgeVdc61TojIA3.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/SDOseBbCKJ98fZt.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/MtWRiBdSZOqGD6P.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/MNQSKIuPV9xw5OT.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/01/05/6AF281xXNmcJ5iW.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/" itemprop="item" rel="index" title="分类于 学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/middleware/" itemprop="item" rel="index" title="分类于 中间件学习"><span itemprop="name">中间件学习</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/learn/middleware/ELK/" itemprop="item" rel="index" title="分类于 ELK"><span itemprop="name">ELK</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://jalen.site/learn/middleware/elk/ES%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB(ES%20to%20ES)/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Jalen Chu"><meta itemprop="description" content="A happy life, ٩(●˙▿˙●)۶…⋆ฺ ->"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Follow your heart"></span><div class="body md" itemprop="articleBody"><h1 id="es数据迁移"><a class="anchor" href="#es数据迁移">#</a> ES 数据迁移</h1><blockquote><p>背景：业务数据量很大，数据分布在各个 dc 下面，每个 dc 对应自己的 es cluster，现需要采集每个 dc 下 es cluster 中指定数据，这里指定是指采集特定 index 下指定的 metrics，需要通过 lucene 配合 DSL 筛选数据，现考虑两种方式。</p></blockquote><h2 id="方式一使用后台job脚本定时获取"><a class="anchor" href="#方式一使用后台job脚本定时获取">#</a> 方式一：使用后台 job + 脚本定时获取</h2><p>基于我们已有的 job 集群环境，创建 Job 执行脚本（如 python 脚本），通过 API 方式采集各个 es 端数据源，并将这些数据存入我们的 es，这种方式可以同时将数据写一份到 oracle，但是因为数据量比较大，需要定期清理 oracle 表数据，而且如果清理时选择 DML 也就是 delete 操作的话并不能使 oracle 水位线降低，所以 delete 大表数据会影响后续表查询（扫描）性能，还可能要进行表重建，这也很麻烦，而且因为这个数据主要用来在 grafana 展示，写入 oracle 大概率只能说是备份近期数据，没有太多作用，所以可以省略该环节，并且之前提到过 grafana oracle 插件付费，grafana 无法直接对接 oracle 数据源也是一个因素。</p><p>附 python job 脚本</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> elasticsearch <span class="token keyword">import</span> Elasticsearch<span class="token punctuation">,</span> helpers</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">es_migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    client <span class="token operator">=</span> Elasticsearch<span class="token punctuation">(</span>hosts<span class="token operator">=</span><span class="token string">'https://xxx.xxx.com/esapi'</span><span class="token punctuation">,</span> http_auth<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 下面 DSL 可以从 kibana discover Inspect 打开复制过来，时间作为参数传进来，所以需要 job 每 run 一次记一次时间，然后下一次运行只需获取 last run time 到当前时间的</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    query <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token string">"bool"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token string">"must"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                        <span class="token string">"query_string"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"metrics.appName:dajiangyou"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                            <span class="token string">"analyze_wildcard"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                            <span class="token string">"time_zone"</span><span class="token punctuation">:</span> <span class="token string">"GMT+0"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token string">"filter"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                        <span class="token string">"range"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                            <span class="token string">"@timestamp"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                                <span class="token string">"gte"</span><span class="token punctuation">:</span> <span class="token string">"2022-03-15T02:02:43.748Z"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                                <span class="token string">"lte"</span><span class="token punctuation">:</span> <span class="token string">"2022-03-15T04:02:43.748Z"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                                <span class="token string">"format"</span><span class="token punctuation">:</span> <span class="token string">"strict_date_optional_time"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token string">"should"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token string">"must_not"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment"># client.search(index=metric['esindex'], body=dsl, request_timeout=300)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment"># helpers.scan 返回一个 python 生成器 generator</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    resp <span class="token operator">=</span> helpers<span class="token punctuation">.</span>scan<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        client<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        query<span class="token operator">=</span>query<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        index<span class="token operator">=</span>es_index_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        size<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 数据写入内存记录</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">for</span> num<span class="token punctuation">,</span> doc <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> doc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>doc<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment"># 转 pandas 的 DataFrame 格式，方便使用 to_sql 以 append 方式追加至 oracle 表</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    d_type <span class="token operator">=</span> util<span class="token punctuation">.</span>set_d_type_dict<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># 指定类型，优化存储性能，提速</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    df<span class="token punctuation">.</span>to_sql<span class="token punctuation">(</span><span class="token string">'table_name'</span><span class="token punctuation">,</span> engine<span class="token punctuation">,</span> if_exists<span class="token operator">=</span><span class="token string">'append'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>d_type<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    </pre></td></tr><tr><td data-num="52"></td><td><pre>    es_host_list <span class="token operator">=</span> ES_HOSTS<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    my_es <span class="token operator">=</span> Elasticsearch<span class="token punctuation">(</span>hosts<span class="token operator">=</span>es_host_list<span class="token punctuation">,</span> http_auth<span class="token operator">=</span><span class="token punctuation">(</span>ES_USERNAME<span class="token punctuation">,</span> ES_PASSWORD<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    documents <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"_index"</span><span class="token punctuation">:</span> metric<span class="token punctuation">[</span><span class="token string">'storedtable'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                  <span class="token string">"_source"</span><span class="token punctuation">:</span> doc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                  <span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>doc<span class="token punctuation">[</span><span class="token string">'createtime'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>doc<span class="token punctuation">[</span><span class="token string">'env'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>doc<span class="token punctuation">[</span><span class="token string">'dc'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span>   <span class="token comment"># 下次插入同样 id 时数据覆盖</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                 <span class="token keyword">for</span> doc <span class="token keyword">in</span> data<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    bulk<span class="token punctuation">(</span>my_es<span class="token punctuation">,</span> documents<span class="token punctuation">)</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9lbGFzdGljc2VhcmNoLXB5LnJlYWR0aGVkb2NzLmlvL2VuL3Y4LjEuMC8=">https://elasticsearch-py.readthedocs.io/en/v8.1.0/</span><br><span class="exturl" data-url="aHR0cHM6Ly9rYi5vYmplY3Ryb2NrZXQuY29tL2VsYXN0aWNzZWFyY2gvaG93LXRvLXVzZS1weXRob24taGVscGVycy10by1idWxrLWxvYWQtZGF0YS1pbnRvLWFuLWVsYXN0aWNzZWFyY2gtaW5kZXg=">https://kb.objectrocket.com/elasticsearch/how-to-use-python-helpers-to-bulk-load-data-into-an-elasticsearch-index</span><br><span class="exturl" data-url="aHR0cHM6Ly9rYi5vYmplY3Ryb2NrZXQuY29tL2VsYXN0aWNzZWFyY2gvZWxhc3RpY3NlYXJjaC1hbmQtc2Nyb2xsLWluLXB5dGhvbi05NTM=">https://kb.objectrocket.com/elasticsearch/elasticsearch-and-scroll-in-python-953</span><br><span class="exturl" data-url="aHR0cHM6Ly9lbGFzdGljc2VhcmNoLXB5LnJlYWR0aGVkb2NzLmlvL2VuLzcueC9oZWxwZXJzLmh0bWwjc2Nhbg==">https://elasticsearch-py.readthedocs.io/en/7.x/helpers.html#scan</span></p><h2 id="方式二logstash"><a class="anchor" href="#方式二logstash">#</a> 方式二：logstash</h2><p>通过在 /etc/logstash/conf.d/ 目录下添加 logstash 配置文件，自动拉去 es 数据源 output 到我们 es 集群。</p><pre><code>input&#123;
    elasticsearch &#123;
        hosts =&gt; &quot;https://xxx-xxx.xxx.com/esapi&quot;
        index =&gt; &quot;metrics-xxx-*&quot;
        user =&gt; 'es_username'
        password =&gt; '************'
        query =&gt; '&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;must&quot;: [&#123; &quot;query_string&quot;: &#123;&quot;query&quot;: &quot;metrics.xxx:xxxx OR metrics.xxx:xxxx&quot;&#125;  &#125;]  &#125;  &#125; &#125;'
        size =&gt; 500
        scroll =&gt; &quot;5m&quot;
        docinfo =&gt; true
        docinfo_target =&gt; &quot;[@metadata][doc]&quot;
        schedule =&gt; &quot;*/5 * * * *&quot;
    &#125;
&#125;


output&#123;
    elasticsearch&#123;
        hosts =&gt; [&quot;xx.xx.xx.xx:9200&quot;, &quot;xx.xx.xx.xx:9200&quot;, &quot;xx.xx.xx.xx:9200&quot;, &quot;xx.xx.xx.xx:9200&quot;]
        user =&gt; &quot;our_es_username&quot;
        password =&gt; &quot;*************&quot;
        index =&gt; &quot;my_es_index_name&quot;
        document_id =&gt; &quot;%&#123;[@metadata][doc][_id]&#125;&quot;
    &#125;
&#125;
</code></pre><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>当前感觉 logstash 采集比较方便，所以可以选择方式二，如果需要数据录入 db，可以选择方式一，当然还有其他办法，比如通过 apache airflow 或者其他一些第三方开源项目都可以，但是第二种对于数据处理没有走程序灵活，而且通常我们从 es 里拿的都是聚合处理后的数据，所以两者各有优缺点</p><div class="tags"><a href="/tags/es/" rel="tag"><i class="ic i-tag"></i> es</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-08-07 01:04:04" itemprop="dateModified" datetime="2024-08-07T01:04:04+08:00">2024-08-07</time> </span><span id="learn/middleware/elk/ES数据迁移(ES to ES)/" class="item leancloud_visitors" data-flag-title="ES 数据迁移（ES to ES）" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/mywechatpay.png" alt="Jalen Chu 微信支付"><p>微信支付</p></div><div><img data-src="/images/myalipay.png" alt="Jalen Chu 支付宝"><p>支付宝</p></div><div><img data-src="/images/mywxgzh.png" alt="Jalen Chu 公众号"><p>公众号</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Jalen Chu <i class="ic i-at"><em>@</em></i>Follow your heart</li><li class="link"><strong>本文链接：</strong> <a href="http://jalen.site/learn/middleware/elk/ES%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB(ES%20to%20ES)/" title="ES 数据迁移（ES to ES）">http://jalen.site/learn/middleware/elk/ES数据迁移(ES to ES)/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/learn/middleware/elk/logstash%E9%87%87%E9%9B%86oracle%E6%95%B0%E6%8D%AE/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;01&#x2F;05&#x2F;zXPJsr9V3c7YfoG.jpg" title="logstash采集oracle数据"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> ELK</span><h3>logstash采集oracle数据</h3></a></div><div class="item right"><a href="/learn/devops/grafana/Grafana%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;01&#x2F;05&#x2F;MtWRiBdSZOqGD6P.jpg" title="Grafana二次开发"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Grafana</span><h3>Grafana二次开发</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#es%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB"><span class="toc-number">1.</span> <span class="toc-text">ES 数据迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%E4%BD%BF%E7%94%A8%E5%90%8E%E5%8F%B0job%E8%84%9A%E6%9C%AC%E5%AE%9A%E6%97%B6%E8%8E%B7%E5%8F%96"><span class="toc-number">1.1.</span> <span class="toc-text">方式一：使用后台 job + 脚本定时获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8Clogstash"><span class="toc-number">1.2.</span> <span class="toc-text">方式二：logstash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/learn/middleware/elk/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/" rel="bookmark" title="简单了解倒排索引">简单了解倒排索引</a></li><li><a href="/learn/middleware/elk/%E7%AE%80%E5%8D%95%E5%AE%89%E8%A3%85elasticsearch/" rel="bookmark" title="简单安装elasticsearch">简单安装elasticsearch</a></li><li><a href="/learn/middleware/elk/es%E9%9B%86%E7%BE%A4%E5%B0%8F%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="bookmark" title="es集群脑裂问题">es集群脑裂问题</a></li><li><a href="/learn/middleware/elk/elasticsearch%E9%9B%86%E7%BE%A4%E7%AE%80%E5%8D%95%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE/" rel="bookmark" title="elasticsearch集群简单登录配置">elasticsearch集群简单登录配置</a></li><li><a href="/learn/middleware/elk/logstash%E9%87%87%E9%9B%86oracle%E6%95%B0%E6%8D%AE/" rel="bookmark" title="logstash采集oracle数据">logstash采集oracle数据</a></li><li class="active"><a href="/learn/middleware/elk/ES%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB(ES%20to%20ES)/" rel="bookmark" title="ES数据迁移（ES to ES）">ES数据迁移（ES to ES）</a></li><li><a href="/learn/middleware/elk/es%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E5%B1%9E%E6%80%A7%E5%B9%B6%E4%B8%94terms%E7%BB%9F%E8%AE%A1count/" rel="bookmark" title="es合并两个属性并且terms统计count">es合并两个属性并且terms统计count</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Jalen Chu" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Jalen Chu</p><div class="description" itemprop="description">٩(●˙▿˙●)۶…⋆ฺ -></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">700</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">100</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">210</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NpbmNlcmVseVVuaXF1ZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;SincerelyUnique"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9qYWxlbl9jaHU=" title="https:&#x2F;&#x2F;twitter.com&#x2F;jalen_chu"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9qYWxlbmNodQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;jalenchu"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvbXkvbS9tdXNpYy9wbGF5bGlzdD9pZD0yMDMxOTczNDY0" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;my&#x2F;m&#x2F;music&#x2F;playlist?id&#x3D;2031973464"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS9KYWxlbkNodQ==" title="https:&#x2F;&#x2F;about.me&#x2F;JalenChu"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjExNTIzNTc0NzlAcXEuY29t" title="mailto:1152357479@qq.com"><i class="ic i-envelope"></i></span> <span class="exturl item facebook" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2phbGVuLmNodS43OTIv" title="https:&#x2F;&#x2F;www.facebook.com&#x2F;jalen.chu.792&#x2F;"><i class="ic i-facebook"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xMTExNzYxOC9qYWxlbi1jaHU=" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;11117618&#x2F;jalen-chu"><i class="ic i-stack-overflow"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ3FQRnVtUGpGMWVRdVJrdWp0NUR1YWc=" title="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCqPFumPjF1eQuRkujt5Duag"><i class="ic i-youtube"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/webstack/" rel="section"><i class="ic i-user"></i>网址</a></li><li class="item dropdown"><a href="/html/%E5%9C%88%E5%B0%8F%E7%8C%AB.html" rel="section"><i class="ic i-tags"></i>玩耍</a><ul class="submenu"><li class="item"><a href="/html/%E5%9C%88%E5%B0%8F%E7%8C%AB.html" rel="section"><i class="ic i-tags"></i>圈小猫</a></li><li class="item"><a href="/html/%E6%92%95%E6%B8%94%E7%BD%91.html" rel="section"><i class="ic i-tags"></i>撕渔网</a></li><li class="item"><a href="/html/%E5%BD%A9%E8%99%B9%E9%9B%A8.html" rel="section"><i class="ic i-tags"></i>彩虹雨</a></li><li class="item"><a href="/html/%E6%96%B9%E5%9D%97%E7%A9%BF%E6%A2%AD.html" rel="section"><i class="ic i-tags"></i>方块穿梭</a></li><li class="item"><a href="/html/%E7%83%9F%E8%8A%B1%E6%95%88%E6%9E%9C.html" rel="section"><i class="ic i-tags"></i>烟花效果</a></li><li class="item"><a href="/html/%E7%A2%B0%E6%92%9E%E5%B0%8F%E7%90%83.html" rel="section"><i class="ic i-tags"></i>碰撞小球</a></li><li class="item"><a href="/html/%E7%BA%B8%E9%A3%9E%E6%9C%BA.html" rel="section"><i class="ic i-tags"></i>纸飞机</a></li><li class="item"><a href="/html/%E9%AA%87%E5%AE%A2%E5%B8%9D%E5%9B%BD.html" rel="section"><i class="ic i-tags"></i>骇客帝国</a></li><li class="item"><a href="/html/%E7%8E%AB%E7%91%B0%E8%8A%B1.html" rel="section"><i class="ic i-tags"></i>玫瑰花</a></li><li class="item"><a href="/html/%E9%97%AE%E9%97%AE%E9%A2%98.html" rel="section"><i class="ic i-tags"></i>问问题</a></li></ul></li><li class="item"><a href="/html/resume/index.html" rel="section"><i class="ic i-th"></i>简历</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/learn/middleware/elk/logstash%E9%87%87%E9%9B%86oracle%E6%95%B0%E6%8D%AE/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/learn/devops/grafana/Grafana%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Research/" title="分类于 Research">Research</a></div><span><a href="/Vision%20Unit%20Test/" title="Vision Unit Test">Vision Unit Test</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/code-highlight/" title="Code Highlight Style test">Code Highlight Style test</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/devops/" title="分类于 DevOPS">DevOPS</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/devops/Linux/" title="分类于 Linux">Linux</a></div><span><a href="/learn/devops/linux/xftp%E4%BC%A0%E8%BE%93unknow%20error/" title="xftp传输unknow error">xftp传输unknow error</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/frontent/" title="分类于 前端知识学习">前端知识学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/frontent/ExtJS/" title="分类于 ExtJS">ExtJS</a></div><span><a href="/learn/frontent/ext-js/SenchaCmd%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%884%EF%BC%89-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5class-system/" title="SenchaCmd学习笔记（4）:核心概念class system">SenchaCmd学习笔记（4）:核心概念class system</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Servlet/" title="分类于 Servlet">Servlet</a></div><span><a href="/Servlet%E8%AE%BF%E9%97%AEpostgresql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE%E6%98%BE%E7%A4%BA%E5%9C%A8%E5%89%8D%E7%AB%AFjsp%E9%A1%B5%E9%9D%A2/" title="Servlet访问postgresql数据库并提取数据显示在前端jsp页面">Servlet访问postgresql数据库并提取数据显示在前端jsp页面</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/database/" title="分类于 数据库学习">数据库学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/database/Redis/" title="分类于 Redis">Redis</a></div><span><a href="/learn/database/redis/spring%20data%20redis%E7%AE%80%E5%8D%95%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95redis/" title="spring data redis简单连接测试redis">spring data redis简单连接测试redis</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/webstorm%E8%AF%86%E5%88%ABalias%20@/" title="webstorm识别alias @">webstorm识别alias @</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/network/" title="分类于 计算机网络">计算机网络</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/network/%E5%9B%BE%E8%A7%A3HTTP/" title="分类于 图解 HTTP">图解 HTTP</a></div><span><a href="/learn/network/pic-http/%E5%9B%BE%E8%A7%A3HTTP%E5%AD%A6%E4%B9%A0%EF%BC%883%EF%BC%89%EF%BC%9A%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E7%9A%84HTTP%E7%8A%B6%E6%80%81%E7%A0%81/" title="图解HTTP学习（3）：返回结果的HTTP状态码">图解HTTP学习（3）：返回结果的HTTP状态码</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/devops/" title="分类于 DevOPS">DevOPS</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/devops/Linux/" title="分类于 Linux">Linux</a></div><span><a href="/learn/devops/linux/%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3chmod%E5%91%BD%E4%BB%A4/" title="简单了解Linux chmod命令">简单了解Linux chmod命令</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/learn/" title="分类于 学习">学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/Java-%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/" title="分类于 Java 语言学习">Java 语言学习</a> <i class="ic i-angle-right"></i> <a href="/categories/learn/java/Liferay/" title="分类于 Liferay">Liferay</a></div><span><a href="/learn/java/liferay/liferay%E9%9B%86%E6%88%90springmvc%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="liferay集成springmvc学习笔记">liferay集成springmvc学习笔记</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Jalen Chu @ Jalen's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">2m 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">29:45</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"learn/middleware/elk/ES数据迁移(ES to ES)/",favicon:{show:"（●´3｀●）復活成功",hide:"(´Д｀)瀏覽器崩潰啦"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:{placeholder:"1. 提问前请先仔细阅读本文档⚡\n2. 页面显示问题💥，请提供控制台截图📸或者您的测试网址\n3. 其他任何报错💣，请提供详细描述和截图📸，祝食用愉快💪"},fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?908585f2e8b845b564946752e587f4a0";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/z16.model.json"},display:{position:"left",width:200,height:400},mobile:{show:!0},react:{opacity:.7}})</script></body></html>